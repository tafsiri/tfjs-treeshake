!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("path"),require("fs"),require("worker_threads"),require("perf_hooks")):"function"==typeof define&&define.amd?define(["path","fs","worker_threads","perf_hooks"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).path,e.fs,e.worker_threads,e.perf_hooks)}(this,(function(e,t,n,r){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;class a{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}setPlatform(e,t){null!=this.platform&&console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){const t=this.urlFlags[e];console.warn(`Setting feature override from URL ${e}: ${t}.`),this.set(e,t)}}async getAsync(e){return e in this.flags||(this.flags[e]=await this.evaluateFlag(e)),this.flags[e]}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(t instanceof Promise)throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(null==this.flagRegistry[e])throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(null==this.flagRegistry[e])throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const e=function(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(e,...n)=>(function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,n[0],n[1]),n.join("="))),t}(this.global.location.search);if("tfjsflags"in e){e.tfjsflags.split(",").forEach(e=>{const[t,n]=e.split(":");this.urlFlags[t]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error(`Could not parse value flag value ${t} for flag ${e}.`)}(t,n)})}}}function s(){return i}let o,i=null;function u(){if(null==o){let e;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof global)e=global;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}o=e}return o}function l(e,t){const n=function(){const e=u();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);{const r=t();return n.set(e,r),n.get(e)}}const c=l("kernelRegistry",()=>new Map),f=l("gradRegistry",()=>new Map);function d(e){return f.get(e)}function p(e){const t=c.entries(),n=[];for(;;){const{done:r,value:a}=t.next();if(r)break;const[s,o]=a,[i]=s.split("_");i===e&&n.push(o)}return n}function h(e,t){return`${t}_${e}`}function m(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function _(e,t=[],n=!1){if(null==t&&(t=[]),Array.isArray(e)||w(e)&&!n)for(let r=0;r<e.length;++r)_(e[r],t,n);else t.push(e);return t}function y(e){if(0===e.length)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function g(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function v(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function E(e,t){const n=t.length;return m((e=null==e?t.map((e,t)=>t):[].concat(e)).every(e=>e>=-n&&e<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis `+e),m(e.every(e=>e%1==0),()=>"All values in axis param must be integers but got axis "+e),e.map(e=>e<0?n+e:e)}function w(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function b(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function T(e){return"string"==typeof e||e instanceof String}function k(e){return!!(e&&e.constructor&&e.call&&e.apply)}function I(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function A(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=_(e)),s().getBool("DEBUG")&&function(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${t} being uploaded contains ${r}.`)}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){const t=new Uint8Array(e.length);for(let n=0;n<t.length;++n)0!==Math.round(e[n])&&(t[n]=1);return t}throw new Error("Unknown data type "+t)}function S(e,t){if(0===e.length)return t[0];const n=e.reduce((e,t)=>e*t);if(0===n)return[];if(n!==t.length)throw new Error(`[${e}] does not match the input size ${t.length}.`);return function e(t,n,r){const a=new Array;if(1===n.length){const e=n[0];for(let n=0;n<e;n++)a[n]=r[t+n]}else{const s=n[0],o=n.slice(1),i=o.reduce((e,t)=>e*t);for(let n=0;n<s;n++)a[n]=e(t+n*i,o,r)}return a}(0,e,t)}function x(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function D(){return s().platform.now()}function N(e,t="utf-8"){return t=t||"utf-8",s().platform.decode(e,t)}class M{constructor(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new R)}profileKernel(e,t,n){let r;const a=this.backendTimer.time(()=>{r=n()});r.map(t=>{t.data().then(n=>{!function(e,t,n){if("float32"!==t)return!1;for(let t=0;t<e.length;t++){const r=e[t];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}}(n,t.dtype,e)})});return{kernelName:e,outputs:r,inputs:t,timeMs:a.then(e=>e.kernelMs),extraInfo:a.then(e=>null!=e.getExtraProfileInfo?e.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:n,timeMs:r,inputs:a,extraInfo:s}=e;n.forEach(e=>{Promise.all([e.data(),r,s]).then(n=>{this.logger.logKernelProfile(t,e,n[0],n[1],a,n[2])})})}}class R{logKernelProfile(e,t,n,r,a,s){const o="number"==typeof r?v(r+"ms",9):r.error,i=v(e,25),u=t.rank,l=t.size,c=v(t.shape.toString(),14);let f="";for(const e in a){const n=a[e].shape||t.shape,r=n.length;f+=`${e}: ${r}D ${r>0?n:""} `}console.log(`%c${i}\t%c${o}\t%c${u}D ${c}\t%c${l}\t%c${f}\t%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}function O(e,t,n,r){const a=I(t),s=function(e,t,n,r){const a=y(t),s=r[r.length-1],o=new Array(s).fill(0),i=t.length,u="complex64"===n?F(e):e;if(i>1)for(let e=0;e<a/s;e++){const t=e*s;for(let e=0;e<s;e++)o[e]=Math.max(o[e],B(u[t+e],0,n).length)}return o}(e,t,n,a),o=t.length,i=function e(t,n,r,a,s,o=!0){const i="complex64"===r?2:1,u=n[0],l=n.length;if(0===l){if("complex64"===r){return[B(F(t)[0],0,r)]}return"bool"===r?[C(t[0])]:[t[0].toString()]}if(1===l){if(u>20){const e=3*i;let n=Array.from(t.slice(0,e)),a=Array.from(t.slice((u-3)*i,u*i));return"complex64"===r&&(n=F(n),a=F(a)),["["+n.map((e,t)=>B(e,s[t],r)).join(", ")+", ..., "+a.map((e,t)=>B(e,s[u-3+t],r)).join(", ")+"]"]}return["["+("complex64"===r?F(t):Array.from(t)).map((e,t)=>B(e,s[t],r)).join(", ")+"]"]}const c=n.slice(1),f=a.slice(1),d=a[0]*i,p=[];if(u>20){for(let n=0;n<3;n++){const a=n*d,o=a+d;p.push(...e(t.slice(a,o),c,r,f,s,!1))}p.push("...");for(let n=u-3;n<u;n++){const a=n*d,o=a+d;p.push(...e(t.slice(a,o),c,r,f,s,n===u-1))}}else for(let n=0;n<u;n++){const a=n*d,o=a+d;p.push(...e(t.slice(a,o),c,r,f,s,n===u-1))}const h=2===l?",":"";p[0]="["+p[0]+h;for(let e=1;e<p.length-1;e++)p[e]=" "+p[e]+h;let m=",\n";for(let e=2;e<l;e++)m+="\n";return p[p.length-1]=" "+p[p.length-1]+"]"+(o?"":m),p}(e,t,n,a,s),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+o),u.push(`  shape: [${t}]`),u.push("  values:")),u.push(i.map(e=>"    "+e).join("\n")),u.join("\n")}function B(e,t,n){let r;return r=Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":T(e)?`'${e}'`:"bool"===n?C(e):parseFloat(e.toFixed(7)).toString(),v(r,t)}function C(e){return 0===e?"false":"true"}function F(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}let P=null;class L{constructor(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=y(e),this.strides=I(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return null.buffer(this.shape,this.dtype,e)}bufferSync(){return null.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return S(this.shape,e)}arraySync(){return S(this.shape,this.dataSync())}async data(){this.throwIfDisposed();const e=P().read(this.dataId);if("string"===this.dtype){const t=await e;try{return t.map(e=>N(e))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataSync(){this.throwIfDisposed();const e=P().readSync(this.dataId);if("string"===this.dtype)try{return e.map(e=>N(e))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await P().read(this.dataId);return"string"===this.dtype?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(P().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return null.print(this,e)}clone(){return this.throwIfDisposed(),null.clone(this)}toString(e=!1){return O(this.dataSync(),this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),null.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),P().makeVariable(this,e,t,n)}}Object.defineProperty(L,Symbol.hasInstance,{value:e=>!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype});class W extends L{constructor(e,t,n,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!g(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);P().disposeTensor(this),this.dataId=e.dataId,P().incRef(this,null)}dispose(){P().disposeVariable(this),this.isDisposedInternal=!0}}function U(e){const t=[];return function e(t,n,r){if(null==t)return;if(t instanceof L)return void n.push(t);if(a=t,!Array.isArray(a)&&"object"!=typeof a)return;var a;const s=t;for(const t in s){const a=s[t];r.has(a)||(r.add(a),e(a,n,r))}}(e,t,new Set),t}Object.defineProperty(W,Symbol.hasInstance,{value:e=>e instanceof L&&null!=e.assign&&e.assign instanceof Function});class j{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class H{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new j}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then(()=>{});if(null!=this.backendInstance)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;{const{asyncInit:t}=this.initializeBackend(e);if(t)return null}}return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,n=1){return e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(null==this.registryFactory[e])throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,null==this.registry[e]){this.backendInstance=null;const{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new M(this.backendInstance),!0}setupRegisteredKernels(){p(this.backendName).forEach(e=>{null!=e.setupFunc&&e.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){p(e).forEach(t=>{null!=t.disposeFunc&&t.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(null==t)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const n=t.factory();if(Promise.resolve(n)===n){const t=++this.pendingBackendInitId,r=n.then(n=>!(t<this.pendingBackendInitId)&&(this.registry[e]=n,this.pendingBackendInit=null,!0)).catch(n=>(t<this.pendingBackendInitId||(this.pendingBackendInit=null,console.warn(`Initialization of backend ${e} failed`),console.warn(n.stack||n.message)),!1));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}return this.registry[e]=n,{success:!0,asyncInit:!1}}catch(t){return console.warn(`Initialization of backend ${e} failed`),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t],{success:r,asyncInit:a}=this.initializeBackend(n);if(a||r)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,a,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n,r=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}return this.scopedRun(()=>this.startScope(r),()=>this.endScope(n),()=>(n=t(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n))}scopedRun(e,t,n){e();try{const e=n();return t(),e}catch(e){throw t(),e}}nextTensorId(){return H.nextTensorId++}nextVariableId(){return H.nextVariableId++}clone(e){const t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],e=>({x:()=>{const t={x:e},n={dtype:"float32"};return G.runKernelFunc(t=>t.cast(e,"float32"),t,null,"Cast",n)}}),[],{}),t}runKernel(e,t,n,r,a){return this.runKernelFunc(null,t,null,e,n,r,a)}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){const r=this.backend.numDataIds();let a=0;n.forEach(e=>{a+="complex64"===e.dtype?3:1});const s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-s;if(o>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${o} data ids) after running '${e}'`)}runKernelFunc(e,t,n,r,a,s,o){let i,u=[];const l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");const f=this.state.numBytes,d=this.state.numTensors;let p;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);const m=function(e,t){const n=h(e,t);return c.get(n)}(r,this.backendName);let _,y;if(null!=m)p=()=>{const e=this.backend.numDataIds();_=m.kernelFunc({inputs:t,attrs:a,backend:this.backend});const n=Array.isArray(_)?_:[_];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(r,e,n);const i=n.map(({dataId:e,shape:t,dtype:n})=>this.makeTensorFromDataId(e,t,n));if(l){let e=this.getTensorsForGradient(r,t,i);if(null==e){null==o&&(o=[]);const t=i.filter((e,t)=>o[t]);e=(s||[]).slice().concat(t)}u=this.saveTensorsForBackwardMode(e)}return i};else{const t=e=>{l&&(u=e.map(e=>this.keep(this.clone(e))))};p=()=>{const n=this.backend.numDataIds();_=this.tidy(()=>e(this.backend,t));const a=Array.isArray(_)?_:[_];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(r,n,a),a}}return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(y=this.profiler.profileKernel(r,t,()=>p()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(y),i=y.outputs):i=p()}),l&&this.addTapeNode(r,t,i,n,u,a),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-f,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-d,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(e=>null!=t[e]?t[e].shape:null),outputShapes:i.map(e=>e.shape),kernelTimeMs:y.timeMs,extraInfo:y.extraInfo}),Array.isArray(_)?i:i[0]}saveTensorsForBackwardMode(e){return e.map(e=>this.keep(this.clone(e)))}getTensorsForGradient(e,t,n){const r=d(e);if(null!=r){const e=r.inputsToSave||[],a=r.outputsToSave||[];let s;r.saveAllInputs?(m(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),s=Object.keys(t).map(e=>t[e])):s=e.map(e=>t[e]);const o=n.filter((e,t)=>a[t]);return s.concat(o)}return null}makeTensor(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let a=e;"string"===n&&T(e[0])&&(a=e.map(e=>function(e,t="utf-8"){return t=t||"utf-8",s().platform.encode(e,t)}(e)));const o=r.write(a,t,n),i=new L(t,n,o,this.nextTensorId());if(this.incRef(i,r),"string"===n){const e=this.state.tensorInfo.get(o),t=function(e){if(null==e)return 0;let t=0;return e.forEach(e=>t+=e.length),t}(a);this.state.numBytes+=t-e.bytes,e.bytes=t}return i}makeTensorFromDataId(e,t,n,r){const a=new L(t,n=n||"float32",e,this.nextTensorId());return this.incRef(a,r),a}makeVariable(e,t=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));const a=new W(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error(`Variable with name ${a.name} was already registered`);return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}incRef(e,t){const n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;let n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*b(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n,refCount:0}),this.state.numBytes+=n}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof W||this.track(e)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;const t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(e=>e.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const e of this.state.activeProfile.kernels)e.kernelTimeMs=await e.kernelTimeMs,e.extraInfo=await e.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(e,t,n,r,a,s){const o={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},i=d(e);null!=i&&(r=i.gradFunc),null!=r&&(o.gradient=e=>(e=e.map((e,t)=>{if(null==e){const e=n[t],r=x(e.size,e.dtype);return this.makeTensor(r,e.shape,e.dtype)}return e}),r(e.length>1?e:e[0],a,s))),this.state.activeTape.push(o)}keep(e){return e.kept=!0,e}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=U(e),n=new Set(t.map(e=>e.id));for(let e=0;e<this.state.activeScope.track.length;e++){const t=this.state.activeScope.track[e];t.kept||n.has(t.id)||t.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(e=>{e.kept||e.scopeId!==r.id||this.track(e)})}gradients(e,t,n,r=!1){if(m(t.length>0,()=>"gradients() received an empty list of xs."),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const a=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));m(a instanceof L,()=>"The result y returned by f() must be a tensor.");const s=function(e,t,n){const r={},a={};for(let e=0;e<t.length;e++)r[t[e].id]=!0;for(let n=0;n<e.length;n++){const s=e[n],o=s.inputs;for(const e in o){const n=o[e];let i=!1;for(let e=0;e<t.length;e++)if(r[n.id]){s.outputs.forEach(e=>r[e.id]=!0),i=!0,a[s.id]=!0;break}if(i)break}}const s={};s[n.id]=!0;const o={};for(let t=e.length-1;t>=0;t--){const n=e[t],r=n.inputs;for(let e=0;e<n.outputs.length;e++)if(s[n.outputs[e].id]){for(const e in r)s[r[e].id]=!0,o[n.id]=!0;break}}const i=[];for(let t=0;t<e.length;t++){const n=e[t];if(a[n.id]&&o[n.id]){const e={};for(const t in n.inputs){const a=n.inputs[t];r[a.id]&&(e[t]=a)}const t=Object.assign({},n);t.inputs=e,t.outputs=n.outputs,i.push(t)}}return i}(this.state.activeTape,t,a);if(!r&&0===s.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const e={};e[a.id]=null==n?function(e){const t=function(e,t){const n=x(e,t);for(let e=0;e<n.length;e++)n[e]=1;return n}(y(e),"float32");return G.makeTensor(t,e,"float32")}(a.shape):n,function(e,t,n,r){for(let a=t.length-1;a>=0;a--){const s=t[a],o=[];if(s.outputs.forEach(t=>{const n=e[t.id];null!=n?o.push(n):o.push(null)}),null==s.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);const i=s.gradient(o);for(const t in s.inputs){if(!(t in i))throw new Error(`Cannot backprop through input ${t}. Available gradients found: ${Object.keys(i)}.`);const a=n(()=>i[t]());if("float32"!==a.dtype)throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${t} must have 'float32' dtype, but has '${a.dtype}'`);const o=s.inputs[t];if(!g(a.shape,o.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${t}' has shape '${a.shape}', which does not match the shape of the input '${o.shape}'`);if(null==e[o.id])e[o.id]=a;else{const t=e[o.id];e[o.id]=r(t,a),t.dispose()}}}}(e,s,e=>this.tidy(e),V);const r=t.map(t=>e[t.id]);return 0===this.state.gradientDepth&&(this.state.activeTape.forEach(e=>{for(const t of e.saved)t.dispose()}),this.state.activeTape=null),{value:a,grads:r}})}customGrad(e){return m(k(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{let n;m(t.every(e=>e instanceof L),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");const r={};return t.forEach((e,t)=>{r[t]=e}),this.runKernelFunc((r,a)=>(n=e(...t,a),m(n.value instanceof L,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),m(k(n.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n.value),r,(e,r)=>{const a=n.gradFunc(e,r),s=Array.isArray(a)?a:[a];m(s.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),m(s.every(e=>e instanceof L),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const o={};return s.forEach((e,t)=>{o[t]=()=>e}),o})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}async time(e){const t=D(),n=await this.backend.time(e);return n.wallMs=D()-t,n}track(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new j;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}H.nextTensorId=0,H.nextVariableId=0;const G=function(){const e=u();if(null==e._tfengine){const t=new a(e);e._tfengine=new H(t)}var t;return t=e._tfengine.ENV,i=t,P=()=>e._tfengine,e._tfengine}();function V(e,t){const n={a:e,b:t};return G.runKernelFunc((n,r)=>{const a=n.add(e,t);return r([e,t]),a},n,null,"Add")}function q(e,t){let n=e;if(w(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];const r=[];for(;Array.isArray(n)||w(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&s().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],!Array.isArray(t)&&!w(t))return void m(0===n.length,()=>`Element arr[${r.join("][")}] is a primitive, but should be an array/TypedArray of ${n[0]} elements`);m(n.length>0,()=>`Element arr[${r.join("][")}] should be a primitive, but is an array of ${t.length} elements`),m(t.length===n[0],()=>`Element arr[${r.join("][")}] should have ${n[0]} elements, but has ${t.length} elements`);const a=n.slice(1);for(let n=0;n<t.length;++n)e(t[n],a,r.concat(n))}(e,r,[]),r}function $(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error(`Argument '${n}' passed to '${r}' must be ${e} tensor, but got ${t} tensor`)}function z(e,t,n,r="numeric"){if(e instanceof L)return $(r,e.dtype,t,n),e;let a=function e(t){return Array.isArray(t)?e(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":"number"==typeof t?"float32":T(t)?"string":function(e){return"boolean"==typeof e}(t)?"bool":"float32"}(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),$(r,a,t,n),null==e||!w(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){const r=null==e?"null":e.constructor.name;throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const s=q(e,a);w(e)||Array.isArray(e)||(e=[e]);const o="string"!==a?A(e,a):_(e,[],!0);return G.makeTensor(o,s,a)}function K(e){const t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");let n=t[0];const r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));const a=(...e)=>{G.startScope(n);try{const t=r(...e);return t instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),G.endScope(t),t}catch(e){throw G.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}const X=K({reshape_:function(e,t){const n=z(e,"x","reshape",null);t=function(e,t){let n=1,r=-1;for(let t=0;t<e.length;++t)if(e[t]>=0)n*=e[t];else if(-1===e[t]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${t}`);r=t}else if(e[t]<0)throw Error(`Shapes can not be < 0. Found ${e[t]} at dim ${t}`);if(-1===r){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${e}`);return e}if(0===n)throw Error(`Cannot infer the missing size in [${e}] when there are 0 elements`);if(t%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);const a=e.slice();return a[r]=t/n,a}(t,n.size),m(n.size===y(t),()=>"new shape and old shape must have the same number of elements.");const r={x:n},a={shape:t};return G.runKernelFunc((e,r)=>(r([n]),e.reshape(n,t)),r,null,"Reshape",a)}});const Q=K({transpose_:function(e,t){const n=z(e,"x","transpose");if(null==t&&(t=n.shape.map((e,t)=>t).reverse()),m(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${t}.`),t.forEach(e=>{m(e>=0&&e<n.rank,()=>"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t)}),n.rank<=1)return n.clone();const r={x:n},a={perm:t};return G.runKernelFunc(e=>e.transpose(n,t),r,null,"Transpose",a)}});function Y(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Z(e,t){return function(e,t,n){const r=e.length+t.length,a=[];let s=0,o=0;for(let i=0;i<r;i++)-1===n.indexOf(i)?a.push(e[s++]):a.push(t[o++]);return a}(e,t.map(e=>1),t)}function J(e,t){if(Y(e,t))return null;const n=[];for(let r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach(e=>n.push(e)),n}function ee(e,t){const n=[];for(let r=t-e;r<t;++r)n.push(r);return n}const te=K({max_:function(e,t=null,n=!1){const r=z(e,"x","max"),a={x:r},s={reductionIndices:t,keepDims:n};return G.runKernelFunc((e,a)=>{let s=E(t,r.shape);const o=J(s,r.rank);let i=r;null!=o&&(i=Q(r,o),s=ee(s.length,i.rank));const u=e.max(i,s);null!=o&&i.dispose();let l=u;if(n){const e=Z(l.shape,E(t,r.shape));l=X(l,e),u.dispose()}return a([r,l]),l},a,null,"Max",s)}});function ne(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}class re{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}function ae(e){throw new Error(`'${e}' not yet implemented or not found in the registry. Did you forget to import the kernel?`)}const se=s();se.registerFlag("DEBUG",()=>!1,e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),se.registerFlag("IS_BROWSER",()=>"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope),se.registerFlag("IS_NODE",()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node),se.registerFlag("IS_CHROME",()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)),se.registerFlag("PROD",()=>!1),se.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>se.getBool("DEBUG")),se.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0),se.registerFlag("IS_TEST",()=>!1);class oe{fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}}s().get("IS_BROWSER")&&s().setPlatform("browser",new oe);const ie=()=>require("node-fetch");let ue;class le{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return null!=s().global.fetch?s().global.fetch(e,t):(null==ue&&(ue=ie()),ue(e,t))}now(){const e=process.hrtime();return 1e3*e[0]+e[1]/1e6}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)}decode(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}var ce,fe;s().get("IS_NODE")&&s().setPlatform("node",new le),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}(ce||(ce={})),function(e){let t;!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(fe||(fe={}));const de=s();de.registerFlag("WASM_HAS_SIMD_SUPPORT",async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]))),de.registerFlag("WASM_HAS_MULTITHREAD_SUPPORT",async()=>{try{return(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch(e){return!1}});var pe=ne((function(a,s){var o,i=(o="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(o=o||__filename),function(a){function s(){return x.buffer!=q&&J(x.buffer),$}function i(){return x.buffer!=q&&J(x.buffer),z}function u(){return x.buffer!=q&&J(x.buffer),K}function l(){return x.buffer!=q&&J(x.buffer),X}function c(){return x.buffer!=q&&J(x.buffer),Q}var f,d=void 0!==(a=a||{})?a:{},p={};for(f in d)d.hasOwnProperty(f)&&(p[f]=d[f]);var h=!1,m=!1,_=!1,y=!1;h="object"==typeof window,m="function"==typeof importScripts,_="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,y=!h&&!_&&!m;var g=d.ENVIRONMENT_IS_PTHREAD||!1;g&&(q=d.buffer,ee=d.DYNAMIC_BASE,te=d.DYNAMICTOP_PTR);var v,E,w,b,T="";function k(e){return d.locateFile?d.locateFile(e,T):T+e}if(_){var I;T=m?e.dirname(T)+"/":__dirname+"/",v=function(n,r){return w||(w=t),b||(b=e),n=b.normalize(n),w.readFileSync(n,r?null:"utf8")},E=function(e){var t=v(e,!0);return t.buffer||(t=new Uint8Array(t)),C(t.buffer),t},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof fn))throw e})),process.on("unhandledRejection",Ee),d.inspect=function(){return"[Emscripten Module object]"};try{I=n}catch(e){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),e}Worker=I.Worker}else y?("undefined"!=typeof read&&(v=function(e){return read(e)}),E=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(C("object"==typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs&&scriptArgs,"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(h||m)&&(m?T=self.location.href:document.currentScript&&(T=document.currentScript.src),o&&(T=o),T=0!==T.indexOf("blob:")?T.substr(0,T.lastIndexOf("/")+1):"",_?(v=function(n,r){return w||(w=t),b||(b=e),n=b.normalize(n),w.readFileSync(n,r?null:"utf8")},E=function(e){var t=v(e,!0);return t.buffer||(t=new Uint8Array(t)),C(t.buffer),t}):(v=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},m&&(E=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)})));_&&"undefined"==typeof performance&&(performance=r.performance);var A,S,x,D=d.print||console.log.bind(console),N=d.printErr||console.warn.bind(console);for(f in p)p.hasOwnProperty(f)&&(d[f]=p[f]);p=null,d.arguments&&d.arguments,d.thisProgram&&d.thisProgram,d.quit&&d.quit,d.wasmBinary&&(A=d.wasmBinary),d.noExitRuntime&&(S=d.noExitRuntime),"object"!=typeof WebAssembly&&N("no native wasm support detected");var M,R=new WebAssembly.Table({initial:165,maximum:165,element:"anyfunc"}),O=0,B=!1;function C(e,t){e||Ee("Assertion failed: "+t)}function F(e){var t=d["_"+e];return C(t,"Cannot call unknown function "+e+", make sure it is exported"),t}function P(e,t,n,r,a){var s={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);H(e,t=un(n),n)}return t},array:function(e){var t=un(e.length);return V(e,t),t}},o=F(e),i=[],u=0;if(r)for(var l=0;l<r.length;l++){var c=s[n[l]];c?(0===u&&(u=on()),i[l]=c(r[l])):i[l]=r[l]}var f=o.apply(null,i);return f=function(e){return"string"===t?U(e):"boolean"===t?Boolean(e):e}(f),0!==u&&ln(u),f}function L(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e}));return"string"!==t&&a&&!r?F(e):function(){return P(e,t,n,arguments)}}function W(e,t,n){for(var r=t+n,a="";!(t>=r);){var s=e[t++];if(!s)return a;if(128&s){var o=63&e[t++];if(192!=(224&s)){var i=63&e[t++];if((s=224==(240&s)?(15&s)<<12|o<<6|i:(7&s)<<18|o<<12|i<<6|63&e[t++])<65536)a+=String.fromCharCode(s);else{var u=s-65536;a+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else a+=String.fromCharCode((31&s)<<6|o)}else a+=String.fromCharCode(s)}return a}function U(e,t){return e?W(i(),e,t):""}function j(e,t,n,r){if(!(r>0))return 0;for(var a=n,s=n+r-1,o=0;o<e.length;++o){var i=e.charCodeAt(o);if(i>=55296&&i<=57343&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++o)),i<=127){if(n>=s)break;t[n++]=i}else if(i<=2047){if(n+1>=s)break;t[n++]=192|i>>6,t[n++]=128|63&i}else if(i<=65535){if(n+2>=s)break;t[n++]=224|i>>12,t[n++]=128|i>>6&63,t[n++]=128|63&i}else{if(n+3>=s)break;t[n++]=240|i>>18,t[n++]=128|i>>12&63,t[n++]=128|i>>6&63,t[n++]=128|63&i}}return t[n]=0,n-a}function H(e,t,n){return j(e,i(),t,n)}function G(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r>=55296&&r<=57343&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++n)),r<=127?++t:t+=r<=2047?2:r<=65535?3:4}return t}function V(e,t){s().set(e,t)}var q,$,z,K,X,Q,Y=65536;function Z(e,t){return e%t>0&&(e+=t-e%t),e}function J(e){q=e,d.HEAP8=$=new Int8Array(e),d.HEAP16=new Int16Array(e),d.HEAP32=K=new Int32Array(e),d.HEAPU8=z=new Uint8Array(e),d.HEAPU16=new Uint16Array(e),d.HEAPU32=X=new Uint32Array(e),d.HEAPF32=new Float32Array(e),d.HEAPF64=Q=new Float64Array(e)}var ee=5256288,te=12480,ne=d.INITIAL_MEMORY||16777216;if(g)x=d.wasmMemory,q=d.buffer;else if(d.wasmMemory)x=d.wasmMemory;else if(!((x=new WebAssembly.Memory({initial:ne/Y,maximum:2147483648/Y,shared:!0})).buffer instanceof SharedArrayBuffer))throw N("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),_&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");function re(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?d.dynCall_v(n):d.dynCall_vi(n,t.arg):n(void 0===t.arg?null:t.arg)}else t(d)}}x&&(q=x.buffer),ne=q.byteLength,J(q),g||(u()[te>>2]=ee);var ae=[],se=[],oe=[],ie=[];function ue(){if(!g){if(d.preRun)for("function"==typeof d.preRun&&(d.preRun=[d.preRun]);d.preRun.length;)de(d.preRun.shift());re(ae)}}function le(){re(se)}function ce(){g||re(oe)}function fe(){if(!g){if(d.postRun)for("function"==typeof d.postRun&&(d.postRun=[d.postRun]);d.postRun.length;)pe(d.postRun.shift());re(ie)}}function de(e){ae.unshift(e)}function pe(e){ie.unshift(e)}var he=Math.ceil,me=Math.floor,_e=0,ye=null;function ge(e){C(!g,"addRunDependency cannot be used in a pthread worker"),_e++,d.monitorRunDependencies&&d.monitorRunDependencies(_e)}function ve(e){if(_e--,d.monitorRunDependencies&&d.monitorRunDependencies(_e),0==_e&&ye){var t=ye;ye=null,t()}}function Ee(e){throw d.onAbort&&d.onAbort(e),g&&console.error("Pthread aborting at "+(new Error).stack),D(e+=""),N(e),B=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.",new WebAssembly.RuntimeError(e)}function we(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}d.preloadedImages={},d.preloadedAudios={};var be="data:application/octet-stream;base64,";function Te(e){return we(e,be)}var ke="file://";function Ie(e){return we(e,ke)}var Ae="tfjs-backend-wasm-threaded-simd.wasm";function Se(){try{if(A)return new Uint8Array(A);if(E)return E(Ae);throw"both async and sync fetching of the wasm failed"}catch(e){Ee(e)}}function xe(){return A||!h&&!m||"function"!=typeof fetch||Ie(Ae)?new Promise((function(e,t){e(Se())})):fetch(Ae,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+Ae+"'";return e.arrayBuffer()})).catch((function(){return Se()}))}function De(){var e={a:qt};function t(e,t){var n=e.exports;if(d.asm=n,M=t,!g){var r=Ge.unusedWorkers.length;Ge.unusedWorkers.forEach((function(e){Ge.loadWasmModuleToWorker(e,(function(){--r||ve()}))}))}}function n(e){t(e.instance,e.module)}function r(t){return xe().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){N("failed to asynchronously prepare wasm: "+e),Ee(e)}))}if(g||ge(),d.instantiateWasm)try{return d.instantiateWasm(e,t)}catch(e){return N("Module.instantiateWasm callback failed with error: "+e),!1}return function(){if(A||"function"!=typeof WebAssembly.instantiateStreaming||Te(Ae)||Ie(Ae)||"function"!=typeof fetch)return r(n);fetch(Ae,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){N("wasm streaming compile failed: "+e),N("falling back to ArrayBuffer instantiation"),r(n)}))}))}(),{}}Te(Ae)||(Ae=k(Ae));var Ne={};function Me(){Ge.initRuntime()}g||se.push({func:function(){Kt()}});var Re=0,Oe=0,Be=0;function Ce(e,t,n){Re=e|=0,Be=t|=0,Oe=n|=0}d.__register_pthread_ptr=Ce;var Fe={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135},Pe=13392;function Le(e,t){if(e<=0||e>s().length||!0&e||t<0)return-28;if(0==t)return 0;t>=2147483647&&(t=1/0);var n=Atomics.load(u(),Pe>>2),r=0;if(n==e&&Atomics.compareExchange(u(),Pe>>2,n,0)==n&&(r=1,--t<=0))return 1;var a=Atomics.notify(u(),e>>2,t);if(a>=0)return a+r;throw"Atomics.notify returned an unexpected value "+a}function We(e){if(g)throw"Internal Error! _kill_thread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in _kill_thread!";u()[e+12>>2]=0;var t=Ge.pthreads[e];t.worker.terminate(),Ge.freeThreadData(t),Ge.runningWorkers.splice(Ge.runningWorkers.indexOf(t.worker),1),t.worker.pthread=void 0}function Ue(e){if(g)throw"Internal Error! _cancel_thread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in _cancel_thread!";Ge.pthreads[e].worker.postMessage({cmd:"cancel"})}function je(e){if(g)throw"Internal Error! _cleanup_thread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in _cleanup_thread!";u()[e+12>>2]=0;var t=Ge.pthreads[e];if(t){var n=t.worker;Ge.returnWorkerToPool(n)}}d._emscripten_futex_wake=Le;var He,Ge={MAIN_THREAD_ID:1,mainThreadInfo:{schedPolicy:0,schedPrio:0},unusedWorkers:[],runningWorkers:[],initRuntime:function(){Ce(Ge.mainThreadBlock,!m,1),nn(Ge.mainThreadBlock)},initMainThreadBlock:function(){for(var e=0;e<8;++e)Ge.allocateUnusedWorker();for(Ge.mainThreadBlock=12640,e=0;e<58;++e)l()[Ge.mainThreadBlock/4+e]=0;u()[Ge.mainThreadBlock+12>>2]=Ge.mainThreadBlock;var t=Ge.mainThreadBlock+156;for(u()[t>>2]=t,e=0;e<128;++e)l()[3220+e]=0;Atomics.store(l(),Ge.mainThreadBlock+104>>2,12880),Atomics.store(l(),Ge.mainThreadBlock+40>>2,Ge.mainThreadBlock),Atomics.store(l(),Ge.mainThreadBlock+44>>2,42)},initWorker:function(){},pthreads:{},exitHandlers:null,setThreadStatus:function(){},runExitHandlers:function(){if(null!==Ge.exitHandlers){for(;Ge.exitHandlers.length>0;)Ge.exitHandlers.pop()();Ge.exitHandlers=null}g&&O&&en()},threadExit:function(e){var t=Ut();t&&(Atomics.store(l(),t+4>>2,e),Atomics.store(l(),t+0>>2,1),Atomics.store(l(),t+60>>2,1),Atomics.store(l(),t+64>>2,0),Ge.runExitHandlers(),Le(t+0,2147483647),Ce(0,0,0),O=0,g&&postMessage({cmd:"exit"}))},threadCancel:function(){Ge.runExitHandlers(),Atomics.store(l(),O+4>>2,-1),Atomics.store(l(),O+0>>2,1),Le(O+0,2147483647),O=0,Ce(0,0,0),postMessage({cmd:"cancelDone"})},terminateAllThreads:function(){for(var e in Ge.pthreads)(r=Ge.pthreads[e])&&r.worker&&Ge.returnWorkerToPool(r.worker);Ge.pthreads={};for(var t=0;t<Ge.unusedWorkers.length;++t)(n=Ge.unusedWorkers[t]).terminate();for(Ge.unusedWorkers=[],t=0;t<Ge.runningWorkers.length;++t){var n,r=(n=Ge.runningWorkers[t]).pthread;Ge.freeThreadData(r),n.terminate()}Ge.runningWorkers=[]},freeThreadData:function(e){if(e){if(e.threadInfoStruct){var t=u()[e.threadInfoStruct+104>>2];u()[e.threadInfoStruct+104>>2]=0,Qt(t),Qt(e.threadInfoStruct)}e.threadInfoStruct=0,e.allocatedOwnStack&&e.stackBase&&Qt(e.stackBase),e.stackBase=0,e.worker&&(e.worker.pthread=null)}},returnWorkerToPool:function(e){delete Ge.pthreads[e.pthread.thread],Ge.unusedWorkers.push(e),Ge.runningWorkers.splice(Ge.runningWorkers.indexOf(e),1),Ge.freeThreadData(e.pthread),e.pthread=void 0},receiveObjectTransfer:function(e){},loadWasmModuleToWorker:function(e,t){e.onmessage=function(n){var r=n.data,a=r.cmd;if(e.pthread&&(Ge.currentProxiedOperationCallerThread=e.pthread.threadInfoStruct),r.targetThread&&r.targetThread!=Ut()){var s=Ge.pthreads[r.targetThread];return s?s.worker.postMessage(n.data,r.transferList):console.error('Internal error! Worker sent a message "'+a+'" to target pthread '+r.targetThread+", but that thread no longer exists!"),void(Ge.currentProxiedOperationCallerThread=void 0)}"processQueuedMainThreadWork"===a?tn():"spawnThread"===a?Lt(n.data):"cleanupThread"===a?je(r.thread):"killThread"===a?We(r.thread):"cancelThread"===a?Ue(r.thread):"loaded"===a?(e.loaded=!0,t&&t(e),e.runPthread&&(e.runPthread(),delete e.runPthread)):"print"===a?D("Thread "+r.threadId+": "+r.text):"printErr"===a?N("Thread "+r.threadId+": "+r.text):"alert"===a?alert("Thread "+r.threadId+": "+r.text):"exit"===a?e.pthread&&Atomics.load(l(),e.pthread.thread+68>>2)&&Ge.returnWorkerToPool(e):"cancelDone"===a?Ge.returnWorkerToPool(e):"objectTransfer"===a?Ge.receiveObjectTransfer(n.data):"setimmediate"===n.data.target?e.postMessage(n.data):N("worker sent an unknown command "+a),Ge.currentProxiedOperationCallerThread=void 0},e.onerror=function(e){N("pthread sent an error! "+e.filename+":"+e.lineno+": "+e.message)},_&&(e.on("message",(function(t){e.onmessage({data:t})})),e.on("error",(function(t){e.onerror(t)})),e.on("exit",(function(e){console.log("worker exited - TODO: update the worker queue?")}))),e.postMessage({cmd:"load",urlOrBlob:d.mainScriptUrlOrBlob||o,wasmMemory:x,wasmModule:M,DYNAMIC_BASE:ee,DYNAMICTOP_PTR:te})},allocateUnusedWorker:function(){var e=k("tfjs-backend-wasm-threaded-simd.worker.js");Ge.unusedWorkers.push(new Worker(e))},getNewWorker:function(){return 0==Ge.unusedWorkers.length&&(Ge.allocateUnusedWorker(),Ge.loadWasmModuleToWorker(Ge.unusedWorkers[0])),Ge.unusedWorkers.length>0?Ge.unusedWorkers.pop():null},busySpinWait:function(e){for(var t=performance.now()+e;performance.now()<t;);}};function Ve(e,t){ln(e)}function qe(){return S}function $e(e,t,n,r){Ee("Assertion failed: "+U(e)+", at: "+[t?U(t):"unknown filename",n,r?U(r):"unknown function"])}function ze(e,t){_main(e,t)}function Ke(e){return u()[Yt()>>2]=e,e}function Xe(e,t){if(g)return at(1,1,e,t)}function Qe(e,t){if(e==t)postMessage({cmd:"processQueuedMainThreadWork"});else if(g)postMessage({targetThread:e,cmd:"processThreadQueue"});else{var n=Ge.pthreads[e],r=n&&n.worker;if(!r)return;r.postMessage({cmd:"processThreadQueue"})}return 1}function Ye(){Ee()}function Ze(e,t){}function Je(e,t,n){if(e<=0||e>s().length||!0&e)return-28;if(m){var r=Atomics.wait(u(),e>>2,t,n);if("timed-out"===r)return-73;if("not-equal"===r)return-6;if("ok"===r)return 0;throw"Atomics.wait returned an unexpected value "+r}if(t!=Atomics.load(u(),e>>2))return-6;var a=performance.now(),o=a+n;Atomics.store(u(),Pe>>2,e);for(var i=e;e==i;){if((a=performance.now())>o)return-73;tn(),e=Atomics.load(u(),Pe>>2)}return 0}function et(){return 0|Be}function tt(){return 0|Oe}function nt(e,t,n){i().copyWithin(e,t,t+n)}function rt(){return navigator.hardwareConcurrency}function at(e,t){for(var n=arguments.length-2,r=on(),a=un(8*n),s=a>>3,o=0;o<n;o++)c()[s+o]=arguments[2+o];var i=an(e,n,a,t);return ln(r),i}d.establishStackSpace=Ve,d.getNoExitRuntime=qe,He=_?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:g?function(){return performance.now()-d.__performance_now_clock_drift}:"undefined"!=typeof dateNow?dateNow:function(){return performance.now()};var st=[];function ot(e,t){ot.array||(ot.array=[]);var n,r=ot.array;for(r.length=0;n=i()[e++];)100===n||102===n?(t=t+7&-8,r.push(c()[t>>3]),t+=8):(t=t+3&-4,r.push(u()[t>>2]),t+=4);return r}function it(e,t,n){st.length=t;for(var r=n>>3,a=0;a<t;a++)st[a]=c()[r+a];var s=e<0,o=s?Ne[-e-1]:Vt[e];if(s){var i=ot(st[1],st[2]);return o.apply(null,i)}return o.apply(null,st)}function ut(){return i().length}function lt(e){try{return x.grow(e-q.byteLength+65535>>>16),J(x.buffer),1}catch(e){}}function ct(e){e>>>=0;var t=ut();if(e<=t)return!1;if(e>2147483648)return!1;for(var n=1;n<=4;n*=2){var r=t*(1+.2/n);if(r=Math.min(r,e+100663296),lt(Math.min(2147483648,Z(Math.max(16777216,e,r),65536))))return!0}return!1}var ft={keyEvent:0,mouseEvent:0,wheelEvent:0,uiEvent:0,focusEvent:0,deviceOrientationEvent:0,deviceMotionEvent:0,fullscreenChangeEvent:0,pointerlockChangeEvent:0,visibilityChangeEvent:0,touchEvent:0,previousFullscreenElement:null,previousScreenX:null,previousScreenY:null,removeEventListenersRegistered:!1,removeAllEventListeners:function(){for(var e=ft.eventHandlers.length-1;e>=0;--e)ft._removeHandler(e);ft.eventHandlers=[],ft.deferredCalls=[]},registerRemoveEventListeners:function(){ft.removeEventListenersRegistered||(ft.removeEventListenersRegistered=!0)},deferredCalls:[],deferCall:function(e,t,n){function r(e,t){if(e.length!=t.length)return!1;for(var n in e)if(e[n]!=t[n])return!1;return!0}for(var a in ft.deferredCalls){var s=ft.deferredCalls[a];if(s.targetFunction==e&&r(s.argsList,n))return}ft.deferredCalls.push({targetFunction:e,precedence:t,argsList:n}),ft.deferredCalls.sort((function(e,t){return e.precedence<t.precedence}))},removeDeferredCalls:function(e){for(var t=0;t<ft.deferredCalls.length;++t)ft.deferredCalls[t].targetFunction==e&&(ft.deferredCalls.splice(t,1),--t)},canPerformEventHandlerRequests:function(){return ft.inEventHandler&&ft.currentEventHandler.allowsDeferredCalls},runDeferredCalls:function(){if(ft.canPerformEventHandlerRequests())for(var e=0;e<ft.deferredCalls.length;++e){var t=ft.deferredCalls[e];ft.deferredCalls.splice(e,1),--e,t.targetFunction.apply(null,t.argsList)}},inEventHandler:0,currentEventHandler:null,eventHandlers:[],removeAllHandlersOnTarget:function(e,t){for(var n=0;n<ft.eventHandlers.length;++n)ft.eventHandlers[n].target!=e||t&&t!=ft.eventHandlers[n].eventTypeString||ft._removeHandler(n--)},_removeHandler:function(e){var t=ft.eventHandlers[e];t.target.removeEventListener(t.eventTypeString,t.eventListenerFunc,t.useCapture),ft.eventHandlers.splice(e,1)},registerOrRemoveHandler:function(e){var t=function(t){++ft.inEventHandler,ft.currentEventHandler=e,ft.runDeferredCalls(),e.handlerFunc(t),ft.runDeferredCalls(),--ft.inEventHandler};if(e.callbackfunc)e.eventListenerFunc=t,e.target.addEventListener(e.eventTypeString,t,e.useCapture),ft.eventHandlers.push(e),ft.registerRemoveEventListeners();else for(var n=0;n<ft.eventHandlers.length;++n)ft.eventHandlers[n].target==e.target&&ft.eventHandlers[n].eventTypeString==e.eventTypeString&&ft._removeHandler(n--)},queueEventHandlerOnThread_iiii:function(e,t,n,r,a){var s=on(),o=un(12);u()[o>>2]=n,u()[o+4>>2]=r,u()[o+8>>2]=a,sn(e,637534208,t,r,o),ln(s)},getTargetThreadForEventCallback:function(e){switch(e){case 1:return 0;case 2:return Ge.currentProxiedOperationCallerThread;default:return e}},getNodeNameForTarget:function(e){return e?e==window?"#window":e==screen?"#screen":e&&e.nodeName?e.nodeName:"":""},fullscreenEnabled:function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}};function dt(e){var t=G(e)+1,n=Xt(t);return H(e,n,t),n}function pt(e,t,n,r){var a=on(),s=un(12),o=0;t&&(o=dt(t)),u()[s>>2]=o,u()[s+4>>2]=n,u()[s+8>>2]=r,sn(e,657457152,0,o,s),ln(a)}function ht(e,t,n,r){pt(e,t=t?U(t):"",n,r)}function mt(e){return e>2?U(e):e}var _t=[0,"undefined"!=typeof document?document:0,"undefined"!=typeof window?window:0];function yt(e){return e=mt(e),_t[e]||("undefined"!=typeof document?document.querySelector(e):void 0)}function gt(e){return yt(e)}function vt(e,t,n){var r=gt(e);if(!r)return-4;if(r.canvasSharedPtr&&(u()[r.canvasSharedPtr>>2]=t,u()[r.canvasSharedPtr+4>>2]=n),!r.offscreenCanvas&&r.controlTransferredOffscreen)return r.canvasSharedPtr?(ht(u()[r.canvasSharedPtr+8>>2],e,t,n),1):-4;r.offscreenCanvas&&(r=r.offscreenCanvas);var a=!1;if(r.GLctxObject&&r.GLctxObject.GLctx){var s=r.GLctxObject.GLctx.getParameter(2978);a=0===s[0]&&0===s[1]&&s[2]===r.width&&s[3]===r.height}return r.width=t,r.height=n,a&&r.GLctxObject.GLctx.viewport(0,0,t,n),0}function Et(e,t,n){return g?at(2,1,e,t,n):vt(e,t,n)}function wt(e,t,n){return gt(e)?vt(e,t,n):Et(e,t,n)}function bt(e){}function Tt(e,t){}function kt(e){var t=e.getExtension("ANGLE_instanced_arrays");if(t)return e.vertexAttribDivisor=function(e,n){t.vertexAttribDivisorANGLE(e,n)},e.drawArraysInstanced=function(e,n,r,a){t.drawArraysInstancedANGLE(e,n,r,a)},e.drawElementsInstanced=function(e,n,r,a,s){t.drawElementsInstancedANGLE(e,n,r,a,s)},1}function It(e){var t=e.getExtension("OES_vertex_array_object");if(t)return e.createVertexArray=function(){return t.createVertexArrayOES()},e.deleteVertexArray=function(e){t.deleteVertexArrayOES(e)},e.bindVertexArray=function(e){t.bindVertexArrayOES(e)},e.isVertexArray=function(e){return t.isVertexArrayOES(e)},1}function At(e){var t=e.getExtension("WEBGL_draw_buffers");if(t)return e.drawBuffers=function(e,n){t.drawBuffersWEBGL(e,n)},1}var St={counter:1,lastError:0,buffers:[],mappedBuffers:{},programs:[],framebuffers:[],renderbuffers:[],textures:[],uniforms:[],shaders:[],vaos:[],contexts:{},currentContext:null,offscreenCanvases:{},timerQueriesEXT:[],programInfos:{},stringCache:{},unpackAlignment:4,init:function(){for(var e=new Float32Array(St.MINI_TEMP_BUFFER_SIZE),t=0;t<St.MINI_TEMP_BUFFER_SIZE;t++)St.miniTempBufferFloatViews[t]=e.subarray(0,t+1);var n=new Int32Array(St.MINI_TEMP_BUFFER_SIZE);for(t=0;t<St.MINI_TEMP_BUFFER_SIZE;t++)St.miniTempBufferIntViews[t]=n.subarray(0,t+1)},recordError:function(e){St.lastError||(St.lastError=e)},getNewId:function(e){for(var t=St.counter++,n=e.length;n<t;n++)e[n]=null;return t},MINI_TEMP_BUFFER_SIZE:256,miniTempBufferFloatViews:[0],miniTempBufferIntViews:[0],getSource:function(e,t,n,r){for(var a="",s=0;s<t;++s){var o=r?u()[r+4*s>>2]:-1;a+=U(u()[n+4*s>>2],o<0?void 0:o)}return a},createContext:function(e,t){var n=e.getContext("webgl",t);return n?St.registerContext(n,t):0},registerContext:function(e,t){var n=Xt(8);u()[n+4>>2]=Ut();var r={handle:n,attributes:t,version:t.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=r),St.contexts[n]=r,(void 0===t.enableExtensionsByDefault||t.enableExtensionsByDefault)&&St.initExtensions(r),n},makeContextCurrent:function(e){return St.currentContext=St.contexts[e],d.ctx=Mt=St.currentContext&&St.currentContext.GLctx,!(e&&!Mt)},getContext:function(e){return St.contexts[e]},deleteContext:function(e){St.currentContext===St.contexts[e]&&(St.currentContext=null),"object"==typeof ft&&ft.removeAllHandlersOnTarget(St.contexts[e].GLctx.canvas),St.contexts[e]&&St.contexts[e].GLctx.canvas&&(St.contexts[e].GLctx.canvas.GLctxObject=void 0),Qt(St.contexts[e].handle),St.contexts[e]=null},initExtensions:function(e){if(e||(e=St.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var t=e.GLctx;kt(t),It(t),At(t),t.disjointTimerQueryExt=t.getExtension("EXT_disjoint_timer_query");var n=["OES_texture_float","OES_texture_half_float","OES_standard_derivatives","OES_vertex_array_object","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","OES_element_index_uint","EXT_texture_filter_anisotropic","EXT_frag_depth","WEBGL_draw_buffers","ANGLE_instanced_arrays","OES_texture_float_linear","OES_texture_half_float_linear","EXT_blend_minmax","EXT_shader_texture_lod","EXT_texture_norm16","WEBGL_compressed_texture_pvrtc","EXT_color_buffer_half_float","WEBGL_color_buffer_float","EXT_sRGB","WEBGL_compressed_texture_etc1","EXT_disjoint_timer_query","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_astc","EXT_color_buffer_float","WEBGL_compressed_texture_s3tc_srgb","EXT_disjoint_timer_query_webgl2","WEBKIT_WEBGL_compressed_texture_pvrtc"];(t.getSupportedExtensions()||[]).forEach((function(e){-1!=n.indexOf(e)&&t.getExtension(e)}))}},populateUniformTable:function(e){for(var t=St.programs[e],n=St.programInfos[e]={uniforms:{},maxUniformLength:0,maxAttributeLength:-1,maxUniformBlockNameLength:-1},r=n.uniforms,a=Mt.getProgramParameter(t,35718),s=0;s<a;++s){var o=Mt.getActiveUniform(t,s),i=o.name;n.maxUniformLength=Math.max(n.maxUniformLength,i.length+1),"]"==i.slice(-1)&&(i=i.slice(0,i.lastIndexOf("[")));var u=Mt.getUniformLocation(t,i);if(u){var l=St.getNewId(St.uniforms);r[i]=[o.size,l],St.uniforms[l]=u;for(var c=1;c<o.size;++c){var f=i+"["+c+"]";u=Mt.getUniformLocation(t,f),l=St.getNewId(St.uniforms),St.uniforms[l]=u}}}}},xt=["default","low-power","high-performance"];function Dt(e,t){var n={},r=t>>2;n.alpha=!!u()[r+0],n.depth=!!u()[r+1],n.stencil=!!u()[r+2],n.antialias=!!u()[r+3],n.premultipliedAlpha=!!u()[r+4],n.preserveDrawingBuffer=!!u()[r+5];var a=u()[r+6];n.powerPreference=xt[a],n.failIfMajorPerformanceCaveat=!!u()[r+7],n.majorVersion=u()[r+8],n.minorVersion=u()[r+9],n.enableExtensionsByDefault=u()[r+10],n.explicitSwapControl=u()[r+11],n.proxyContextToMainThread=u()[r+12],n.renderViaOffscreenBackBuffer=u()[r+13];var s=gt(e);return s?n.explicitSwapControl?-1:St.createContext(s,n):-4}function Nt(e,t){return Dt(e,t)}var Mt,Rt={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var n=Rt.buffers[e];0===t||10===t?((1===e?D:N)(W(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function(){return Rt.varargs+=4,u()[Rt.varargs-4>>2]},getStr:function(e){return U(e)},get64:function(e,t){return e}};function Ot(e){return g?at(3,1,e):0}function Bt(e,t,n,r,a){if(g)return at(4,1,e,t,n,r,a)}function Ct(e,t,n,r){if(g)return at(5,1,e,t,n,r);for(var a=0,s=0;s<n;s++){for(var o=u()[t+8*s>>2],l=u()[t+(8*s+4)>>2],c=0;c<l;c++)Rt.printChar(e,i()[o+c]);a+=l}return u()[r>>2]=a,0}function Ft(e){var t=Ge.exitHandlers.pop();e&&t()}function Pt(e,t){null===Ge.exitHandlers&&(Ge.exitHandlers=[]),Ge.exitHandlers.push((function(){cn(e,t)}))}function Lt(e){if(g)throw"Internal Error! _spawn_thread() can only ever be called from main application thread!";var t=Ge.getNewWorker();if(void 0!==t.pthread)throw"Internal error!";if(!e.pthread_ptr)throw"Internal error, no pthread ptr!";Ge.runningWorkers.push(t);for(var n=Xt(512),r=0;r<128;++r)u()[n+4*r>>2]=0;var a=e.stackBase+e.stackSize,s=Ge.pthreads[e.pthread_ptr]={worker:t,stackBase:e.stackBase,stackSize:e.stackSize,allocatedOwnStack:e.allocatedOwnStack,thread:e.pthread_ptr,threadInfoStruct:e.pthread_ptr},o=s.threadInfoStruct>>2;Atomics.store(l(),o+0,0),Atomics.store(l(),o+1,0),Atomics.store(l(),o+2,0),Atomics.store(l(),o+17,e.detached),Atomics.store(l(),o+26,n),Atomics.store(l(),o+12,0),Atomics.store(l(),o+10,s.threadInfoStruct),Atomics.store(l(),o+11,42),Atomics.store(l(),o+27,e.stackSize),Atomics.store(l(),o+21,e.stackSize),Atomics.store(l(),o+20,a),Atomics.store(l(),o+29,a),Atomics.store(l(),o+30,e.detached),Atomics.store(l(),o+32,e.schedPolicy),Atomics.store(l(),o+33,e.schedPrio);var i=Zt()+40;Atomics.store(l(),o+44,i),t.pthread=s;var c={cmd:"run",start_routine:e.startRoutine,arg:e.arg,threadInfoStruct:e.pthread_ptr,selfThreadId:e.pthread_ptr,parentThreadId:e.parent_pthread_ptr,stackBase:e.stackBase,stackSize:e.stackSize};t.runPthread=function(){c.time=performance.now(),t.postMessage(c,e.transferList)},t.loaded&&(t.runPthread(),delete t.runPthread)}function Wt(e,t,n){if(!t&&!n)return Fe.EINVAL;if(!e)return N("pthread_getschedparam called with a null thread pointer!"),Fe.ESRCH;if(u()[e+12>>2]!==e)return N("pthread_getschedparam attempted on thread "+e+", which does not point to a valid thread, or does not exist anymore!"),Fe.ESRCH;var r=Atomics.load(l(),e+108+20>>2),a=Atomics.load(l(),e+108+24>>2);return t&&(u()[t>>2]=r),n&&(u()[n>>2]=a),0}function Ut(){return 0|Re}function jt(e,t,n,r){if("undefined"==typeof SharedArrayBuffer)return N("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;if(!e)return N("pthread_create called with a null thread pointer!"),28;var a=[];if(g&&0===a.length)return rn(687865856,e,t,n,r);var s=0,o=0,i=0,c=0,f=0;if(t)if(s=u()[t>>2],s+=81920,o=u()[t+8>>2],i=0!==u()[t+12>>2],0===u()[t+16>>2]){var d=u()[t+20>>2],p=u()[t+24>>2];Wt(Ge.currentProxiedOperationCallerThread?Ge.currentProxiedOperationCallerThread:Ut(),t+20,t+24),c=u()[t+20>>2],f=u()[t+24>>2],u()[t+20>>2]=d,u()[t+24>>2]=p}else c=u()[t+20>>2],f=u()[t+24>>2];else s=2097152;var h=0==o;h?o=Jt(16,s):C((o-=s)>0);for(var m=Xt(232),_=0;_<58;++_)l()[(m>>2)+_]=0;u()[e>>2]=m,u()[m+12>>2]=m;var y=m+156;u()[y>>2]=y;var v={stackBase:o,stackSize:s,allocatedOwnStack:h,schedPolicy:c,schedPrio:f,detached:i,startRoutine:n,pthread_ptr:m,parent_pthread_ptr:Ut(),arg:r,transferList:a};return g?(v.cmd="spawnThread",postMessage(v,a)):Lt(v),0}function Ht(e){return(e=+e)>=0?+me(e+.5):+he(e-.5)}function Gt(e){if(g)return at(6,1,e);switch(e){case 30:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:case 79:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return Ke(28),-1}d._pthread_self=Ut,g?Ge.initWorker():Ge.initMainThreadBlock(),St.init();var Vt=[null,Xe,Et,Ot,Bt,Ct,Gt],qt={e:$e,r:ze,w:Qe,a:Ye,l:Ze,d:Je,c:Le,h:He,g:et,x:tt,q:nt,B:rt,t:it,A:ct,u:wt,k:bt,s:Tt,v:Nt,m:Ot,o:Bt,i:Ct,p:Me,memory:x||d.wasmMemory,y:Ft,z:Pt,j:jt,b:Ut,f:Ht,n:Gt,table:R},$t=De();d.asm=$t;var zt,Kt=d.___wasm_call_ctors=function(){return(Kt=d.___wasm_call_ctors=d.asm.C).apply(null,arguments)},Xt=(d._init=function(){return(d._init=d.asm.D).apply(null,arguments)},d._register_tensor=function(){return(d._register_tensor=d.asm.E).apply(null,arguments)},d._dispose_data=function(){return(d._dispose_data=d.asm.F).apply(null,arguments)},d._dispose=function(){return(d._dispose=d.asm.G).apply(null,arguments)},d._Abs=function(){return(d._Abs=d.asm.H).apply(null,arguments)},d._Add=function(){return(d._Add=d.asm.I).apply(null,arguments)},d._AddN=function(){return(d._AddN=d.asm.J).apply(null,arguments)},d._ArgMax=function(){return(d._ArgMax=d.asm.K).apply(null,arguments)},d._AvgPool=function(){return(d._AvgPool=d.asm.L).apply(null,arguments)},d._BatchMatMul=function(){return(d._BatchMatMul=d.asm.M).apply(null,arguments)},d._ClipByValue=function(){return(d._ClipByValue=d.asm.N).apply(null,arguments)},d._Conv2D=function(){return(d._Conv2D=d.asm.O).apply(null,arguments)},d._Conv2DBackpropInput=function(){return(d._Conv2DBackpropInput=d.asm.P).apply(null,arguments)},d._Cos=function(){return(d._Cos=d.asm.Q).apply(null,arguments)},d._CropAndResize=function(){return(d._CropAndResize=d.asm.R).apply(null,arguments)},d._DepthwiseConv2dNative=function(){return(d._DepthwiseConv2dNative=d.asm.S).apply(null,arguments)},d._Div=function(){return(d._Div=d.asm.T).apply(null,arguments)},d._Equal=function(){return(d._Equal=d.asm.U).apply(null,arguments)},d._Exp=function(){return(d._Exp=d.asm.V).apply(null,arguments)},d._FloorDiv=function(){return(d._FloorDiv=d.asm.W).apply(null,arguments)},d._FusedBatchNorm=function(){return(d._FusedBatchNorm=d.asm.X).apply(null,arguments)},d._FusedConv2D=function(){return(d._FusedConv2D=d.asm.Y).apply(null,arguments)},d._FusedDepthwiseConv2D=function(){return(d._FusedDepthwiseConv2D=d.asm.Z).apply(null,arguments)},d._Gather=function(){return(d._Gather=d.asm._).apply(null,arguments)},d._GatherNd=function(){return(d._GatherNd=d.asm.$).apply(null,arguments)},d._Greater=function(){return(d._Greater=d.asm.aa).apply(null,arguments)},d._GreaterEqual=function(){return(d._GreaterEqual=d.asm.ba).apply(null,arguments)},d._Less=function(){return(d._Less=d.asm.ca).apply(null,arguments)},d._LessEqual=function(){return(d._LessEqual=d.asm.da).apply(null,arguments)},d._Log=function(){return(d._Log=d.asm.ea).apply(null,arguments)},d._LogicalAnd=function(){return(d._LogicalAnd=d.asm.fa).apply(null,arguments)},d._Max=function(){return(d._Max=d.asm.ga).apply(null,arguments)},d._MaxPool=function(){return(d._MaxPool=d.asm.ha).apply(null,arguments)},d._Maximum=function(){return(d._Maximum=d.asm.ia).apply(null,arguments)},d._Min=function(){return(d._Min=d.asm.ja).apply(null,arguments)},d._Minimum=function(){return(d._Minimum=d.asm.ka).apply(null,arguments)},d._Multiply=function(){return(d._Multiply=d.asm.la).apply(null,arguments)},d._Negate=function(){return(d._Negate=d.asm.ma).apply(null,arguments)},d._NonMaxSuppressionV3=function(){return(d._NonMaxSuppressionV3=d.asm.na).apply(null,arguments)},d._NonMaxSuppressionV4=function(){return(d._NonMaxSuppressionV4=d.asm.oa).apply(null,arguments)},d._NonMaxSuppressionV5=function(){return(d._NonMaxSuppressionV5=d.asm.pa).apply(null,arguments)},d._NotEqual=function(){return(d._NotEqual=d.asm.qa).apply(null,arguments)},d._OneHot=function(){return(d._OneHot=d.asm.ra).apply(null,arguments)},d._PadV2=function(){return(d._PadV2=d.asm.sa).apply(null,arguments)},d._Pow=function(){return(d._Pow=d.asm.ta).apply(null,arguments)},d._Prelu=function(){return(d._Prelu=d.asm.ua).apply(null,arguments)},d._Relu=function(){return(d._Relu=d.asm.va).apply(null,arguments)},d._Relu6=function(){return(d._Relu6=d.asm.wa).apply(null,arguments)},d._ResizeBilinear=function(){return(d._ResizeBilinear=d.asm.xa).apply(null,arguments)},d._Reverse=function(){return(d._Reverse=d.asm.ya).apply(null,arguments)},d._RotateWithOffset=function(){return(d._RotateWithOffset=d.asm.za).apply(null,arguments)},d._Rsqrt=function(){return(d._Rsqrt=d.asm.Aa).apply(null,arguments)},d._ScatterNd=function(){return(d._ScatterNd=d.asm.Ba).apply(null,arguments)},d._SelectV2=function(){return(d._SelectV2=d.asm.Ca).apply(null,arguments)},d._Sigmoid=function(){return(d._Sigmoid=d.asm.Da).apply(null,arguments)},d._Sin=function(){return(d._Sin=d.asm.Ea).apply(null,arguments)},d._Softmax=function(){return(d._Softmax=d.asm.Fa).apply(null,arguments)},d._Sqrt=function(){return(d._Sqrt=d.asm.Ga).apply(null,arguments)},d._Square=function(){return(d._Square=d.asm.Ha).apply(null,arguments)},d._Sub=function(){return(d._Sub=d.asm.Ia).apply(null,arguments)},d._Sum=function(){return(d._Sum=d.asm.Ja).apply(null,arguments)},d._Tanh=function(){return(d._Tanh=d.asm.Ka).apply(null,arguments)},d._Tile=function(){return(d._Tile=d.asm.La).apply(null,arguments)},d._Transpose=function(){return(d._Transpose=d.asm.Ma).apply(null,arguments)},d.__FusedMatMul=function(){return(d.__FusedMatMul=d.asm.Na).apply(null,arguments)},d._malloc=function(){return(Xt=d._malloc=d.asm.Oa).apply(null,arguments)}),Qt=d._free=function(){return(Qt=d._free=d.asm.Pa).apply(null,arguments)},Yt=(d.___em_js__initPthreadsJS=function(){return(d.___em_js__initPthreadsJS=d.asm.Qa).apply(null,arguments)},d.___errno_location=function(){return(Yt=d.___errno_location=d.asm.Ra).apply(null,arguments)}),Zt=d._emscripten_get_global_libc=function(){return(Zt=d._emscripten_get_global_libc=d.asm.Sa).apply(null,arguments)},Jt=d._memalign=function(){return(Jt=d._memalign=d.asm.Ta).apply(null,arguments)},en=d.___pthread_tsd_run_dtors=function(){return(en=d.___pthread_tsd_run_dtors=d.asm.Ua).apply(null,arguments)},tn=d._emscripten_main_thread_process_queued_calls=function(){return(tn=d._emscripten_main_thread_process_queued_calls=d.asm.Va).apply(null,arguments)},nn=(d._emscripten_current_thread_process_queued_calls=function(){return(d._emscripten_current_thread_process_queued_calls=d.asm.Wa).apply(null,arguments)},d._emscripten_register_main_browser_thread_id=function(){return(nn=d._emscripten_register_main_browser_thread_id=d.asm.Xa).apply(null,arguments)}),rn=(d._emscripten_main_browser_thread_id=function(){return(d._emscripten_main_browser_thread_id=d.asm.Ya).apply(null,arguments)},d._emscripten_async_run_in_main_thread=function(){return(d._emscripten_async_run_in_main_thread=d.asm.Za).apply(null,arguments)},d._emscripten_sync_run_in_main_thread=function(){return(d._emscripten_sync_run_in_main_thread=d.asm._a).apply(null,arguments)},d._emscripten_sync_run_in_main_thread_0=function(){return(d._emscripten_sync_run_in_main_thread_0=d.asm.$a).apply(null,arguments)},d._emscripten_sync_run_in_main_thread_1=function(){return(d._emscripten_sync_run_in_main_thread_1=d.asm.ab).apply(null,arguments)},d._emscripten_sync_run_in_main_thread_2=function(){return(d._emscripten_sync_run_in_main_thread_2=d.asm.bb).apply(null,arguments)},d._emscripten_sync_run_in_main_thread_xprintf_varargs=function(){return(d._emscripten_sync_run_in_main_thread_xprintf_varargs=d.asm.cb).apply(null,arguments)},d._emscripten_sync_run_in_main_thread_3=function(){return(d._emscripten_sync_run_in_main_thread_3=d.asm.db).apply(null,arguments)},d._emscripten_sync_run_in_main_thread_4=function(){return(rn=d._emscripten_sync_run_in_main_thread_4=d.asm.eb).apply(null,arguments)}),an=(d._emscripten_sync_run_in_main_thread_5=function(){return(d._emscripten_sync_run_in_main_thread_5=d.asm.fb).apply(null,arguments)},d._emscripten_sync_run_in_main_thread_6=function(){return(d._emscripten_sync_run_in_main_thread_6=d.asm.gb).apply(null,arguments)},d._emscripten_sync_run_in_main_thread_7=function(){return(d._emscripten_sync_run_in_main_thread_7=d.asm.hb).apply(null,arguments)},d._emscripten_run_in_main_runtime_thread_js=function(){return(an=d._emscripten_run_in_main_runtime_thread_js=d.asm.ib).apply(null,arguments)}),sn=d._emscripten_async_queue_on_thread_=function(){return(sn=d._emscripten_async_queue_on_thread_=d.asm.jb).apply(null,arguments)},on=(d._emscripten_tls_init=function(){return(d._emscripten_tls_init=d.asm.kb).apply(null,arguments)},d.stackSave=function(){return(on=d.stackSave=d.asm.lb).apply(null,arguments)}),un=d.stackAlloc=function(){return(un=d.stackAlloc=d.asm.mb).apply(null,arguments)},ln=d.stackRestore=function(){return(ln=d.stackRestore=d.asm.nb).apply(null,arguments)},cn=d.dynCall_vi=function(){return(cn=d.dynCall_vi=d.asm.ob).apply(null,arguments)};function fn(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function dn(e){function t(){zt||(zt=!0,d.calledRun=!0,B||(le(),ce(),d.onRuntimeInitialized&&d.onRuntimeInitialized(),fe()))}_e>0||(ue(),_e>0||(d.setStatus?(d.setStatus("Running..."),setTimeout((function(){setTimeout((function(){d.setStatus("")}),1),t()}),1)):t()))}if(d.dynCall_v=function(){return(d.dynCall_v=d.asm.pb).apply(null,arguments)},d.dynCall_ii=function(){return(d.dynCall_ii=d.asm.qb).apply(null,arguments)},d.asm=$t,d.cwrap=L,d.PThread=Ge,d.PThread=Ge,d._pthread_self=Ut,d.wasmMemory=x,d.ExitStatus=fn,d.then=function(e){if(zt)e(d);else{var t=d.onRuntimeInitialized;d.onRuntimeInitialized=function(){t&&t(),e(d)}}return d},ye=function e(){zt||dn(),zt||(ye=e)},d.run=dn,d.preInit)for("function"==typeof d.preInit&&(d.preInit=[d.preInit]);d.preInit.length>0;)d.preInit.pop()();return g||(S=!0),g||dn(),a});a.exports=i}));var he=ne((function(n,r){var a,s=(a="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(a=a||__filename),function(n){var r,s=void 0!==(n=n||{})?n:{},o={};for(r in s)s.hasOwnProperty(r)&&(o[r]=s[r]);var i=function(e,t){throw t},u=!1,l=!1,c=!1,f=!1;u="object"==typeof window,l="function"==typeof importScripts,c="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,f=!u&&!c&&!l;var d,p,h,m,_="";function y(e){return s.locateFile?s.locateFile(e,_):_+e}c?(_=l?e.dirname(_)+"/":__dirname+"/",d=function(n,r){return h||(h=t),m||(m=e),n=m.normalize(n),h.readFileSync(n,r?null:"utf8")},p=function(e){var t=d(e,!0);return t.buffer||(t=new Uint8Array(t)),k(t.buffer),t},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof Ie))throw e})),process.on("unhandledRejection",te),i=function(e){process.exit(e)},s.inspect=function(){return"[Emscripten Module object]"}):f?("undefined"!=typeof read&&(d=function(e){return read(e)}),p=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(k("object"==typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs&&scriptArgs,"function"==typeof quit&&(i=function(e){quit(e)}),"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(u||l)&&(l?_=self.location.href:document.currentScript&&(_=document.currentScript.src),a&&(_=a),_=0!==_.indexOf("blob:")?_.substr(0,_.lastIndexOf("/")+1):"",d=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},l&&(p=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}));var g,v,E,w=s.print||console.log.bind(console),b=s.printErr||console.warn.bind(console);for(r in o)o.hasOwnProperty(r)&&(s[r]=o[r]);o=null,s.arguments&&s.arguments,s.thisProgram&&s.thisProgram,s.quit&&(i=s.quit),s.wasmBinary&&(g=s.wasmBinary),s.noExitRuntime&&(v=s.noExitRuntime),"object"!=typeof WebAssembly&&b("no native wasm support detected"),new WebAssembly.Table({initial:147,maximum:147,element:"anyfunc"});var T=!1;function k(e,t){e||te("Assertion failed: "+t)}function I(e){var t=s["_"+e];return k(t,"Cannot call unknown function "+e+", make sure it is exported"),t}function A(e,t,n,r,a){var s={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);C(e,t=Te(n),n)}return t},array:function(e){var t=Te(e.length);return F(e,t),t}},o=I(e),i=[],u=0;if(r)for(var l=0;l<r.length;l++){var c=s[n[l]];c?(0===u&&(u=be()),i[l]=c(r[l])):i[l]=r[l]}var f=o.apply(null,i);return f=function(e){return"string"===t?O(e):"boolean"===t?Boolean(e):e}(f),0!==u&&ke(u),f}function S(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e}));return"string"!==t&&a&&!r?I(e):function(){return A(e,t,n,arguments)}}var x,D,N,M="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function R(e,t,n){for(var r=t+n,a=t;e[a]&&!(a>=r);)++a;if(a-t>16&&e.subarray&&M)return M.decode(e.subarray(t,a));for(var s="";t<a;){var o=e[t++];if(128&o){var i=63&e[t++];if(192!=(224&o)){var u=63&e[t++];if((o=224==(240&o)?(15&o)<<12|i<<6|u:(7&o)<<18|i<<12|u<<6|63&e[t++])<65536)s+=String.fromCharCode(o);else{var l=o-65536;s+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else s+=String.fromCharCode((31&o)<<6|i)}else s+=String.fromCharCode(o)}return s}function O(e,t){return e?R(D,e,t):""}function B(e,t,n,r){if(!(r>0))return 0;for(var a=n,s=n+r-1,o=0;o<e.length;++o){var i=e.charCodeAt(o);if(i>=55296&&i<=57343&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++o)),i<=127){if(n>=s)break;t[n++]=i}else if(i<=2047){if(n+1>=s)break;t[n++]=192|i>>6,t[n++]=128|63&i}else if(i<=65535){if(n+2>=s)break;t[n++]=224|i>>12,t[n++]=128|i>>6&63,t[n++]=128|63&i}else{if(n+3>=s)break;t[n++]=240|i>>18,t[n++]=128|i>>12&63,t[n++]=128|i>>6&63,t[n++]=128|63&i}}return t[n]=0,n-a}function C(e,t,n){return B(e,D,t,n)}function F(e,t){x.set(e,t)}function P(e){s.HEAP8=x=new Int8Array(e),s.HEAP16=new Int16Array(e),s.HEAP32=N=new Int32Array(e),s.HEAPU8=D=new Uint8Array(e),s.HEAPU16=new Uint16Array(e),s.HEAPU32=new Uint32Array(e),s.HEAPF32=new Float32Array(e),s.HEAPF64=new Float64Array(e)}function L(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?s.dynCall_v(n):s.dynCall_vi(n,t.arg):n(void 0===t.arg?null:t.arg)}else t(s)}}s.INITIAL_MEMORY;var W=[],U=[],j=[],H=[];function G(){if(s.preRun)for("function"==typeof s.preRun&&(s.preRun=[s.preRun]);s.preRun.length;)z(s.preRun.shift());L(W)}function V(){L(U)}function q(){L(j)}function $(){if(s.postRun)for("function"==typeof s.postRun&&(s.postRun=[s.postRun]);s.postRun.length;)K(s.postRun.shift());L(H)}function z(e){W.unshift(e)}function K(e){H.unshift(e)}var X=Math.ceil,Q=Math.floor,Y=0,Z=null;function J(e){Y++,s.monitorRunDependencies&&s.monitorRunDependencies(Y)}function ee(e){if(Y--,s.monitorRunDependencies&&s.monitorRunDependencies(Y),0==Y&&Z){var t=Z;Z=null,t()}}function te(e){throw s.onAbort&&s.onAbort(e),w(e+=""),b(e),T=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.",new WebAssembly.RuntimeError(e)}function ne(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}s.preloadedImages={},s.preloadedAudios={};var re="data:application/octet-stream;base64,";function ae(e){return ne(e,re)}var se="file://";function oe(e){return ne(e,se)}var ie="tfjs-backend-wasm.wasm";function ue(){try{if(g)return new Uint8Array(g);if(p)return p(ie);throw"both async and sync fetching of the wasm failed"}catch(e){te(e)}}function le(){return g||!u&&!l||"function"!=typeof fetch||oe(ie)?new Promise((function(e,t){e(ue())})):fetch(ie,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+ie+"'";return e.arrayBuffer()})).catch((function(){return ue()}))}function ce(){var e={env:ve,wasi_snapshot_preview1:ve};function t(e,t){var n=e.exports;s.asm=n,P((E=n.memory).buffer),ee()}function n(e){t(e.instance)}function r(t){return le().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){b("failed to asynchronously prepare wasm: "+e),te(e)}))}if(J(),s.instantiateWasm)try{return s.instantiateWasm(e,t)}catch(e){return b("Module.instantiateWasm callback failed with error: "+e),!1}return function(){if(g||"function"!=typeof WebAssembly.instantiateStreaming||ae(ie)||oe(ie)||"function"!=typeof fetch)return r(n);fetch(ie,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){b("wasm streaming compile failed: "+e),b("falling back to ArrayBuffer instantiation"),r(n)}))}))}(),{}}function fe(e){P(E.buffer)}ae(ie)||(ie=y(ie)),U.push();var de={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var n=de.buffers[e];0===t||10===t?((1===e?w:b)(R(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function(){return de.varargs+=4,N[de.varargs-4>>2]},getStr:function(e){return O(e)},get64:function(e,t){return e}};function pe(e){return 0}function he(e,t,n,r,a){}function me(e,t,n,r){for(var a=0,s=0;s<n;s++){for(var o=N[t+8*s>>2],i=N[t+(8*s+4)>>2],u=0;u<i;u++)de.printChar(e,D[o+u]);a+=i}return N[r>>2]=a,0}function _e(e){xe(e)}function ye(e){_e(e)}function ge(e){return(e=+e)>=0?+Q(e+.5):+X(e-.5)}var ve={emscripten_notify_memory_growth:fe,fd_close:pe,fd_seek:he,fd_write:me,proc_exit:ye,roundf:ge},Ee=ce();s.asm=Ee,s._init=function(){return(s._init=s.asm.init).apply(null,arguments)},s._register_tensor=function(){return(s._register_tensor=s.asm.register_tensor).apply(null,arguments)},s._dispose_data=function(){return(s._dispose_data=s.asm.dispose_data).apply(null,arguments)},s._dispose=function(){return(s._dispose=s.asm.dispose).apply(null,arguments)},s._Abs=function(){return(s._Abs=s.asm.Abs).apply(null,arguments)},s._Add=function(){return(s._Add=s.asm.Add).apply(null,arguments)},s._AddN=function(){return(s._AddN=s.asm.AddN).apply(null,arguments)},s._ArgMax=function(){return(s._ArgMax=s.asm.ArgMax).apply(null,arguments)},s._AvgPool=function(){return(s._AvgPool=s.asm.AvgPool).apply(null,arguments)},s._BatchMatMul=function(){return(s._BatchMatMul=s.asm.BatchMatMul).apply(null,arguments)},s._ClipByValue=function(){return(s._ClipByValue=s.asm.ClipByValue).apply(null,arguments)},s._Conv2D=function(){return(s._Conv2D=s.asm.Conv2D).apply(null,arguments)},s._Conv2DBackpropInput=function(){return(s._Conv2DBackpropInput=s.asm.Conv2DBackpropInput).apply(null,arguments)},s._Cos=function(){return(s._Cos=s.asm.Cos).apply(null,arguments)},s._CropAndResize=function(){return(s._CropAndResize=s.asm.CropAndResize).apply(null,arguments)},s._DepthwiseConv2dNative=function(){return(s._DepthwiseConv2dNative=s.asm.DepthwiseConv2dNative).apply(null,arguments)},s._Div=function(){return(s._Div=s.asm.Div).apply(null,arguments)},s._Equal=function(){return(s._Equal=s.asm.Equal).apply(null,arguments)},s._Exp=function(){return(s._Exp=s.asm.Exp).apply(null,arguments)},s._FloorDiv=function(){return(s._FloorDiv=s.asm.FloorDiv).apply(null,arguments)},s._FusedBatchNorm=function(){return(s._FusedBatchNorm=s.asm.FusedBatchNorm).apply(null,arguments)},s._FusedConv2D=function(){return(s._FusedConv2D=s.asm.FusedConv2D).apply(null,arguments)},s._FusedDepthwiseConv2D=function(){return(s._FusedDepthwiseConv2D=s.asm.FusedDepthwiseConv2D).apply(null,arguments)},s._Gather=function(){return(s._Gather=s.asm.Gather).apply(null,arguments)},s._GatherNd=function(){return(s._GatherNd=s.asm.GatherNd).apply(null,arguments)},s._Greater=function(){return(s._Greater=s.asm.Greater).apply(null,arguments)},s._GreaterEqual=function(){return(s._GreaterEqual=s.asm.GreaterEqual).apply(null,arguments)},s._Less=function(){return(s._Less=s.asm.Less).apply(null,arguments)},s._LessEqual=function(){return(s._LessEqual=s.asm.LessEqual).apply(null,arguments)},s._Log=function(){return(s._Log=s.asm.Log).apply(null,arguments)},s._LogicalAnd=function(){return(s._LogicalAnd=s.asm.LogicalAnd).apply(null,arguments)},s._Max=function(){return(s._Max=s.asm.Max).apply(null,arguments)},s._MaxPool=function(){return(s._MaxPool=s.asm.MaxPool).apply(null,arguments)},s._Maximum=function(){return(s._Maximum=s.asm.Maximum).apply(null,arguments)},s._Min=function(){return(s._Min=s.asm.Min).apply(null,arguments)},s._Minimum=function(){return(s._Minimum=s.asm.Minimum).apply(null,arguments)},s._Multiply=function(){return(s._Multiply=s.asm.Multiply).apply(null,arguments)},s._Negate=function(){return(s._Negate=s.asm.Negate).apply(null,arguments)},s._NonMaxSuppressionV3=function(){return(s._NonMaxSuppressionV3=s.asm.NonMaxSuppressionV3).apply(null,arguments)},s._NonMaxSuppressionV4=function(){return(s._NonMaxSuppressionV4=s.asm.NonMaxSuppressionV4).apply(null,arguments)},s._NonMaxSuppressionV5=function(){return(s._NonMaxSuppressionV5=s.asm.NonMaxSuppressionV5).apply(null,arguments)},s._NotEqual=function(){return(s._NotEqual=s.asm.NotEqual).apply(null,arguments)},s._OneHot=function(){return(s._OneHot=s.asm.OneHot).apply(null,arguments)},s._PadV2=function(){return(s._PadV2=s.asm.PadV2).apply(null,arguments)},s._Pow=function(){return(s._Pow=s.asm.Pow).apply(null,arguments)},s._Prelu=function(){return(s._Prelu=s.asm.Prelu).apply(null,arguments)},s._Relu=function(){return(s._Relu=s.asm.Relu).apply(null,arguments)},s._Relu6=function(){return(s._Relu6=s.asm.Relu6).apply(null,arguments)},s._ResizeBilinear=function(){return(s._ResizeBilinear=s.asm.ResizeBilinear).apply(null,arguments)},s._Reverse=function(){return(s._Reverse=s.asm.Reverse).apply(null,arguments)},s._RotateWithOffset=function(){return(s._RotateWithOffset=s.asm.RotateWithOffset).apply(null,arguments)},s._Rsqrt=function(){return(s._Rsqrt=s.asm.Rsqrt).apply(null,arguments)},s._ScatterNd=function(){return(s._ScatterNd=s.asm.ScatterNd).apply(null,arguments)},s._SelectV2=function(){return(s._SelectV2=s.asm.SelectV2).apply(null,arguments)},s._Sigmoid=function(){return(s._Sigmoid=s.asm.Sigmoid).apply(null,arguments)},s._Sin=function(){return(s._Sin=s.asm.Sin).apply(null,arguments)},s._Softmax=function(){return(s._Softmax=s.asm.Softmax).apply(null,arguments)},s._Sqrt=function(){return(s._Sqrt=s.asm.Sqrt).apply(null,arguments)},s._Square=function(){return(s._Square=s.asm.Square).apply(null,arguments)},s._Sub=function(){return(s._Sub=s.asm.Sub).apply(null,arguments)},s._Sum=function(){return(s._Sum=s.asm.Sum).apply(null,arguments)},s._Tanh=function(){return(s._Tanh=s.asm.Tanh).apply(null,arguments)},s._Tile=function(){return(s._Tile=s.asm.Tile).apply(null,arguments)},s._Transpose=function(){return(s._Transpose=s.asm.Transpose).apply(null,arguments)},s.__FusedMatMul=function(){return(s.__FusedMatMul=s.asm._FusedMatMul).apply(null,arguments)},s._malloc=function(){return(s._malloc=s.asm.malloc).apply(null,arguments)},s._free=function(){return(s._free=s.asm.free).apply(null,arguments)},s.__start=function(){return(s.__start=s.asm._start).apply(null,arguments)};var we,be=s.stackSave=function(){return(be=s.stackSave=s.asm.stackSave).apply(null,arguments)},Te=s.stackAlloc=function(){return(Te=s.stackAlloc=s.asm.stackAlloc).apply(null,arguments)},ke=s.stackRestore=function(){return(ke=s.stackRestore=s.asm.stackRestore).apply(null,arguments)};function Ie(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function Ae(e){var t=s.__start;try{t(),xe(0,!0)}catch(e){if(e instanceof Ie)return;if("unwind"==e)return void(v=!0);var n=e;e&&"object"==typeof e&&e.stack&&(n=[e,e.stack]),b("exception thrown: "+n),i(1,e)}}function Se(e){function t(){we||(we=!0,s.calledRun=!0,T||(V(),q(),s.onRuntimeInitialized&&s.onRuntimeInitialized(),De&&Ae(),$()))}Y>0||(G(),Y>0||(s.setStatus?(s.setStatus("Running..."),setTimeout((function(){setTimeout((function(){s.setStatus("")}),1),t()}),1)):t()))}function xe(e,t){t&&v&&0===e||(v||(T=!0,s.onExit&&s.onExit(e)),i(e,new Ie(e)))}if(s.asm=Ee,s.cwrap=S,s.then=function(e){if(we)e(s);else{var t=s.onRuntimeInitialized;s.onRuntimeInitialized=function(){t&&t(),e(s)}}return s},Z=function e(){we||Se(),we||(Z=e)},s.run=Se,s.preInit)for("function"==typeof s.preInit&&(s.preInit=[s.preInit]);s.preInit.length>0;)s.preInit.pop()();var De=!0;return s.noInitialRun&&(De=!1),v=!0,Se(),n});n.exports=s}));class me extends class{time(e){return ae("time")}read(e){return ae("read")}readSync(e){return ae("readSync")}numDataIds(){return ae("numDataIds")}disposeData(e){return ae("disposeData")}write(e,t,n){return ae("write")}move(e,t,n,r){return ae("move")}memory(){return ae("memory")}floatPrecision(){return ae("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}batchMatMul(e,t,n,r){return ae("batchMatMul")}fusedBatchMatMul({a:e,b:t,transposeA:n,transposeB:r,bias:a,activation:s,preluActivationWeights:o}){return ae("fusedBatchMatMul")}slice(e,t,n){return ae("slice")}stridedSlice(e,t,n,r){return ae("stridedSlice")}unstack(e,t){return ae("unstack")}reverse(e,t){return ae("reverse")}concat(e,t){return ae("concat")}neg(e){return ae("neg")}add(e,t){return ae("add")}addN(e){return ae("addN")}subtract(e,t){return ae("subtract")}multiply(e,t){return ae("multiply")}realDivide(e,t){return ae("realDivide")}floorDiv(e,t){return ae("floorDiv")}sum(e,t){return ae("sum")}prod(e,t){return ae("prod")}unsortedSegmentSum(e,t,n){return ae("unsortedSegmentSum")}argMin(e,t){return ae("argMin")}argMax(e,t){return ae("argMax")}equal(e,t){return ae("equal")}notEqual(e,t){return ae("notEqual")}less(e,t){return ae("less")}lessEqual(e,t){return ae("lessEqual")}greater(e,t){return ae("greater")}greaterEqual(e,t){return ae("greaterEqual")}logicalNot(e){return ae("logicalNot")}logicalAnd(e,t){return ae("logicalAnd")}logicalOr(e,t){return ae("logicalOr")}where(e){return ae("where")}select(e,t,n){return ae("select")}topk(e,t,n){return ae("topk")}min(e,t){return ae("min")}minimum(e,t){return ae("minimum")}mod(e,t){return ae("mod")}max(e,t){return ae("max")}maximum(e,t){return ae("maximum")}all(e,t){return ae("all")}any(e,t){return ae("any")}squaredDifference(e,t){return ae("squaredDifference")}ceil(e){return ae("ceil")}floor(e){return ae("floor")}round(e){return ae("round")}sign(e){return ae("sign")}isNaN(e){return ae("isNaN")}isInf(e){return ae("isInf")}isFinite(e){return ae("isFinite")}pow(e,t){return ae("pow")}exp(e){return ae("exp")}expm1(e){return ae("expm1")}softmax(e,t){return ae("softmax")}log(e){return ae("log")}log1p(e){return ae("log1p")}sqrt(e){return ae("sqrt")}rsqrt(e){return ae("rsqrt")}square(e){return ae("square")}reciprocal(e){return ae("reciprocal")}relu(e){return ae("relu")}relu6(e){return ae("relu6")}prelu(e,t){return ae("prelu")}elu(e){return ae("elu")}eluDer(e,t){return ae("eluDer")}selu(e){return ae("selu")}int(e){return ae("int")}clip(e,t,n){return ae("clip")}abs(e){return ae("abs")}complexAbs(e){return ae("complexAbs")}sigmoid(e){return ae("sigmoid")}softplus(e){return ae("softplus")}sin(e){return ae("sin")}cos(e){return ae("cos")}tan(e){return ae("tan")}asin(e){return ae("asin")}acos(e){return ae("acos")}atan(e){return ae("atan")}atan2(e,t){return ae("atan2")}sinh(e){return ae("sinh")}cosh(e){return ae("cosh")}tanh(e){return ae("tanh")}asinh(e){return ae("asinh")}acosh(e){return ae("acosh")}atanh(e){return ae("atanh")}erf(e){return ae("erf")}step(e,t){return ae("step")}fusedConv2d({input:e,filter:t,convInfo:n,bias:r,activation:a,preluActivationWeights:s}){return ae("fusedConv2d")}conv2d(e,t,n){return ae("conv2d")}conv2dDerInput(e,t,n){return ae("conv2dDerInput")}conv2dDerFilter(e,t,n){return ae("conv2dDerFilter")}fusedDepthwiseConv2D({input:e,filter:t,convInfo:n,bias:r,activation:a,preluActivationWeights:s}){return ae("fusedDepthwiseConv2D")}depthwiseConv2D(e,t,n){return ae("depthwiseConv2D")}depthwiseConv2DDerInput(e,t,n){return ae("depthwiseConv2DDerInput")}depthwiseConv2DDerFilter(e,t,n){return ae("depthwiseConv2DDerFilter")}conv3d(e,t,n){return ae("conv3d")}conv3dDerInput(e,t,n){return ae("conv3dDerInput")}conv3dDerFilter(e,t,n){return ae("conv3dDerFilter")}maxPool(e,t){return ae("maxPool")}maxPoolBackprop(e,t,n,r){return ae("maxPoolBackprop")}avgPool(e,t){return ae("avgPool")}avgPoolBackprop(e,t,n){return ae("avgPoolBackprop")}avgPool3d(e,t){return ae("avgPool3d")}avgPool3dBackprop(e,t,n){return ae("avgPool3dBackprop")}maxPool3d(e,t){return ae("maxPool3d")}maxPool3dBackprop(e,t,n,r){return ae("maxPool3dBackprop")}reshape(e,t){return ae("reshape")}cast(e,t){return ae("cast")}tile(e,t){return ae("tile")}pad(e,t,n){return ae("pad")}transpose(e,t){return ae("transpose")}gather(e,t,n){return ae("gather")}gatherND(e,t){return ae("gatherND")}scatterND(e,t,n){return ae("scatterND")}batchToSpaceND(e,t,n){return ae("batchToSpaceND")}spaceToBatchND(e,t,n){return ae("spaceToBatchND")}resizeBilinear(e,t,n,r){return ae("resizeBilinear")}resizeBilinearBackprop(e,t,n){return ae("resizeBilinearBackprop")}resizeNearestNeighbor(e,t,n,r){return ae("resizeNearestNeighbor")}resizeNearestNeighborBackprop(e,t,n){return ae("resizeNearestNeighborBackprop")}batchNorm(e,t,n,r,a,s){return ae("batchNorm")}localResponseNormalization4D(e,t,n,r,a){return ae("localResponseNormalization4D")}LRNGrad(e,t,n,r,a,s,o){return ae("LRNGrad")}multinomial(e,t,n,r){return ae("multinomial")}oneHot(e,t,n,r){return ae("oneHot")}cumsum(e,t,n,r){return ae("cumsum")}nonMaxSuppression(e,t,n,r,a){return ae("nonMaxSuppression")}fft(e){return ae("fft")}ifft(e){return ae("ifft")}complex(e,t){return ae("complex")}real(e){return ae("real")}imag(e){return ae("imag")}cropAndResize(e,t,n,r,a,s){return ae("cropAndResize")}depthToSpace(e,t,n){return ae("depthToSpace")}split(e,t,n){return ae("split")}sparseToDense(e,t,n,r){return ae("sparseToDense")}diag(e){return ae("diag")}fill(e,t,n){return ae("fill")}onesLike(e){return ae("onesLike")}zerosLike(e){return ae("zerosLike")}linspace(e,t,n){return ae("linspace")}dispose(){return ae("dispose")}}{constructor(e){super(),this.wasm=e,this.dataIdNextNumber=1,this.wasm.tfjs.init(),this.dataIdMap=new re(this,G)}write(e,t,n){const r={};return this.move(r,e,t,n),r}numDataIds(){return this.dataIdMap.numDataIds()}async time(e){const t=D();e();return{kernelMs:D()-t}}move(e,t,n,r){const a=this.dataIdNextNumber++;if("string"===r){const s=t;return void this.dataIdMap.set(e,{id:a,stringBytes:s,shape:n,dtype:r,memoryOffset:null})}const s=y(n),o=s*b(r),i=this.wasm._malloc(o);this.dataIdMap.set(e,{id:a,memoryOffset:i,shape:n,dtype:r}),this.wasm.tfjs.registerTensor(a,s,i),null!=t&&this.wasm.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,o),i)}async read(e){return this.readSync(e)}readSync(e){const{memoryOffset:t,dtype:n,shape:r,stringBytes:a}=this.dataIdMap.get(e);if("string"===n)return a;return function(e,t){switch(t){case"float32":return new Float32Array(e);case"int32":return new Int32Array(e);case"bool":return new Uint8Array(e);default:throw new Error("Unknown dtype "+t)}}(this.wasm.HEAPU8.slice(t,t+y(r)*b(n)).buffer,n)}disposeData(e){const t=this.dataIdMap.get(e);this.wasm._free(t.memoryOffset),this.wasm.tfjs.disposeData(t.id),this.dataIdMap.delete(e)}floatPrecision(){return 32}getMemoryOffset(e){return this.dataIdMap.get(e).memoryOffset}dispose(){this.wasm.tfjs.dispose(),this.wasm=null}memory(){return{unreliable:!1}}makeOutput(e,t,n){let r;if(null==n)r=this.write(null,e,t);else{r={};const a=this.dataIdNextNumber++;this.dataIdMap.set(r,{id:a,memoryOffset:n,shape:e,dtype:t});const s=y(e);this.wasm.tfjs.registerTensor(a,s,n)}return{dataId:r,shape:e,dtype:t}}typedArrayFromHeap({shape:e,dtype:t,dataId:n}){const r=this.wasm.HEAPU8.buffer,{memoryOffset:a}=this.dataIdMap.get(n),s=y(e);switch(t){case"float32":return new Float32Array(r,a,s);case"int32":return new Int32Array(r,a,s);case"bool":return new Uint8Array(r,a,s);default:throw new Error("Uknown dtype "+t)}}}!function(e,t,n=1){G.registerBackend(e,t,n)}("wasm",async()=>{const{wasm:e}=await async function(){const[e,t]=await Promise.all([s().getAsync("WASM_HAS_SIMD_SUPPORT"),s().getAsync("WASM_HAS_MULTITHREAD_SUPPORT")]);return new Promise((n,r)=>{const a={};let s;a.locateFile=(n,r)=>{if(n.endsWith(".worker.js")){const e=new Blob(['var threadInfoStruct=0;var selfThreadId=0;var parentThreadId=0;var Module={};function threadPrintErr(){var text=Array.prototype.slice.call(arguments).join(" ");console.error(text)}function threadAlert(){var text=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:text,threadId:selfThreadId})}var err=threadPrintErr;this.alert=threadAlert;Module["instantiateWasm"]=function(info,receiveInstance){var instance=new WebAssembly.Instance(Module["wasmModule"],info);Module["wasmModule"]=null;receiveInstance(instance);return instance.exports};this.onmessage=function(e){try{if(e.data.cmd==="load"){Module["DYNAMIC_BASE"]=e.data.DYNAMIC_BASE;Module["DYNAMICTOP_PTR"]=e.data.DYNAMICTOP_PTR;Module["wasmModule"]=e.data.wasmModule;Module["wasmMemory"]=e.data.wasmMemory;Module["buffer"]=Module["wasmMemory"].buffer;Module["ENVIRONMENT_IS_PTHREAD"]=true;if(typeof e.data.urlOrBlob==="string"){importScripts(e.data.urlOrBlob)}else{var objectUrl=URL.createObjectURL(e.data.urlOrBlob);importScripts(objectUrl);URL.revokeObjectURL(objectUrl)}Module=WasmBackendModuleThreadedSimd(Module);postMessage({"cmd":"loaded"})}else if(e.data.cmd==="objectTransfer"){Module["PThread"].receiveObjectTransfer(e.data)}else if(e.data.cmd==="run"){Module["__performance_now_clock_drift"]=performance.now()-e.data.time;threadInfoStruct=e.data.threadInfoStruct;Module["__register_pthread_ptr"](threadInfoStruct,0,0);selfThreadId=e.data.selfThreadId;parentThreadId=e.data.parentThreadId;var max=e.data.stackBase;var top=e.data.stackBase+e.data.stackSize;Module["establishStackSpace"](top,max);Module["_emscripten_tls_init"]();Module["PThread"].receiveObjectTransfer(e.data);Module["PThread"].setThreadStatus(Module["_pthread_self"](),1);try{var result=Module["dynCall_ii"](e.data.start_routine,e.data.arg);if(!Module["getNoExitRuntime"]())Module["PThread"].threadExit(result)}catch(ex){if(ex==="Canceled!"){Module["PThread"].threadCancel()}else if(ex!="unwind"){Atomics.store(Module["HEAPU32"],threadInfoStruct+4>>2,ex instanceof Module["ExitStatus"]?ex.status:-2);Atomics.store(Module["HEAPU32"],threadInfoStruct+0>>2,1);Module["_emscripten_futex_wake"](threadInfoStruct+0,2147483647);if(!(ex instanceof Module["ExitStatus"]))throw ex}}}else if(e.data.cmd==="cancel"){if(threadInfoStruct){Module["PThread"].threadCancel()}}else if(e.data.target==="setimmediate"){}else if(e.data.cmd==="processThreadQueue"){if(threadInfoStruct){Module["_emscripten_current_thread_process_queued_calls"]()}}else{err("worker.js received unknown command "+e.data.cmd);err(e.data)}}catch(ex){err("worker.js onmessage() captured an uncaught exception: "+ex);if(ex.stack)err(ex.stack);throw ex}};if(typeof process==="object"&&typeof process.versions==="object"&&typeof process.versions.node==="string"){self={location:{href:__filename}};var onmessage=this.onmessage;var nodeWorkerThreads=require("worker_threads");Worker=nodeWorkerThreads.Worker;var parentPort=nodeWorkerThreads.parentPort;parentPort.on("message",function(data){onmessage({data:data})});var nodeFS=require("fs");var nodeRead=function(filename){return nodeFS.readFileSync(filename,"utf8")};function globalEval(x){global.require=require;global.Module=Module;eval.call(null,x)}importScripts=function(f){globalEval(nodeRead(f))};postMessage=function(msg){parentPort.postMessage(msg)};if(typeof performance==="undefined"){performance={now:function(){return Date.now()}}}}'],{type:"application/javascript"});return URL.createObjectURL(e)}return n.endsWith(".wasm")?function(e,t,n){let r="tfjs-backend-wasm.wasm";e&&t&&(r="tfjs-backend-wasm-threaded-simd.wasm");e&&(r="tfjs-backend-wasm-simd.wasm");if(null!=ye&&null!=ye[r])return ye[r];return n+r}(e,t,r):r+n},t&&e&&null==_e?(s=pe(a),s.mainScriptUrlOrBlob=new Blob(["var _scriptDir = undefined; var WasmBackendModuleThreadedSimd = "+pe.toString()],{type:"text/javascript"})):s=he(a);s.tfjs={init:s.cwrap("init",null,[]),registerTensor:s.cwrap("register_tensor",null,["number","number","number"]),disposeData:s.cwrap("dispose_data",null,["number"]),dispose:s.cwrap("dispose",null,[])};let o=!1;s.onRuntimeInitialized=()=>{o=!0,ge=!1,n({wasm:s})},s.onAbort=()=>{if(o)return;if(ge)return;ge=!0;r({message:"Make sure the server can serve the `.wasm` file relative to the bundled js file. For more details see https://github.com/tensorflow/tfjs/blob/master/tfjs-backend-wasm/README.md#using-bundlers"})}})}();return new me(e)},2);let _e=null,ye={},ge=!1;var ve,Ee;let we;function be(e){const{inputs:t,backend:n,attrs:r}=e,[a,s]=function(e,t){const n=[],r=[];for(let a=0;a<e.length;++a)1!==e[a]&&n.push(e[a]),1!==e[t[a]]&&r.push(t[a]);for(let e=0;e<r.length;++e){let t=-1;for(let n=0;n<r.length;++n)r[n]>=e&&(-1===t||r[t]>r[n])&&(t=n);r[t]=e}return[n,r]}(t.x.shape,r.perm);let o=!0;for(let e=0;e<s.length;e++)s[e]!==e&&(o=!1);const i=function(e,t){const n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[t[r]];return n}(t.x.shape,r.perm),u={dataId:t.x.dataId,shape:a,dtype:t.x.dtype};if(o){const e=function(e){const{inputs:{x:t},backend:n}=e,r=n.makeOutput(t.shape,t.dtype),a=n.typedArrayFromHeap(t);return n.typedArrayFromHeap(r).set(a),r}({inputs:t,backend:n});return e.shape=i,e}const l=n.makeOutput(i,u.dtype);n.dataIdMap.get(u.dataId).id,n.dataIdMap.get(l.dataId).id;return(void 0)(),l}!function(e){e[e.float32=0]="float32",e[e.int32=1]="int32",e[e.bool=2]="bool",e[e.string=3]="string",e[e.complex64=4]="complex64"}(ve||(ve={})),function(e){e[e.linear=0]="linear",e[e.relu=1]="relu",e[e.relu6=2]="relu6",e[e.prelu=3]="prelu"}(Ee||(Ee={}));!function(e){const{kernelName:t,backendName:n}=e,r=h(t,n);c.has(r)&&console.warn(`The kernel '${t}' for backend '${n}' is already registered`),c.set(r,e)}({kernelName:"Max",backendName:"wasm",setupFunc:function(e){we=e.wasm.cwrap("Max",null,["number, number, number"])},kernelFunc:function(e){const{backend:t,inputs:n,attrs:r}=e,{reductionIndices:a,keepDims:s}=r,{x:o}=n;let i=t.dataIdMap.get(o.dataId).id,u=o;const{transposed:l,axes:c,originalAxes:f,inputWasTransposed:d}=function(e,t,n){const r=e.shape,a=e.shape.length,s=E(t,r);let o=s;const i=J(o,a);let u=null,l=!1;if(null!=i){const t=new Array(a);for(let e=0;e<t.length;e++)t[e]=r[i[e]];o=ee(o.length,a),u=be({inputs:{x:e},attrs:{perm:i},backend:n});const s=n.dataIdMap.get(e.dataId).id;n.dataIdMap.get(u.dataId).id!==s&&(l=!0)}return{transposed:u,originalAxes:s,axes:o,inputWasTransposed:l}}(o,a,t);if(d){u=l,i=t.dataIdMap.get(l.dataId).id}!function(e,t,n){m(Y(t,n),()=>e+" supports only inner-most axes for now. "+`Got axes ${t} and rank-${n} input.`)}("max",c,u.shape.length);const[p,h]=function(e,t){const n=[],r=e.length;for(let a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map(t=>e[t])]}(u.shape,c),_=y(h),g=t.makeOutput(p,o.dtype);if(0!==y(u.shape)){const e=t.dataIdMap.get(g.dataId).id;we(i,_,e)}if(d&&t.disposeData(l.dataId),s){const e=Z(g.shape,f);g.shape=e}return g}});const Te=te([1,2,3,4]);console.log("Max result",Te.dataSync())}));
//# sourceMappingURL=forward_mode_wasm.js.map
